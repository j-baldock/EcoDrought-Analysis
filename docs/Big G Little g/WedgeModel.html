<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; The Wedge Model â€“ EcoDrought Capstone</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Qualitative/Hysteresis.html" rel="next">
<link href="../Event Delineation/HydroEvents.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-2ef01e258a497a70032e58193e2c5164.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-e84d0a51d8b171802d723e26b1748781.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">

<script src="../site_libs/leaflet-1.3.1/leaflet.js"></script>

<link href="../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">

<script src="../site_libs/proj4-2.6.2/proj4.min.js"></script>

<script src="../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>

<link href="../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">

<script src="../site_libs/leaflet-binding-2.2.2/leaflet.js"></script>

<script src="../site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>

<script src="../site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>

<link href="../site_libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">

<script src="../site_libs/HomeButton-0.0.1/home-button.js"></script>

<script src="../site_libs/HomeButton-0.0.1/easy-button-src.min.js"></script>

<script src="../site_libs/clipboard-0.0.1/setClipboardText.js"></script>

<link href="../site_libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">

<link href="../site_libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">



</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Event Delineation/WeeklySummary.html">Big G-Little g</a></li><li class="breadcrumb-item"><a href="../Big G Little g/WedgeModel.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Wedge Model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">EcoDrought Capstone</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Data Availability/CollateData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Collate Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Explore Data/ExploreData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Explore Long-Term Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Explore Data/TemporalResolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Explore Sub-Daily Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Big G Little g/GgStoryPlots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">G-g Story Plots</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Covariates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Covariates/LandscapeCovariates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Landscape Covariates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Covariates/PASTA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">PASTA</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Big G-Little g</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Event Delineation/WeeklySummary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Daily and Weekly Summaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Event Delineation/HydroEvents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hydro Event Delineation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Big G Little g/WedgeModel.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Wedge Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Qualitative/Hysteresis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Hysteresis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Existing Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Qualitative/ModeledQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Modeled Flow</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Paper</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Qualitative/Overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Qualitative/SpaceTimeVar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Spatiotemporal Variation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Qualitative/LowFlow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Low Flow Variation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../FluvialSynch/FluvialSynch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">FluvialSynch</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Qualitative/Boxes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Boxes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">DEPRECATED</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Big G Little g/GgDiffKS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">G-g Difference (KS)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Big G Little g/GgDiffJAGS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">G-g Difference (JAGS)</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#q-h-a" id="toc-q-h-a" class="nav-link active" data-scroll-target="#q-h-a"><span class="header-section-number">10.1</span> Q, H, A</a>
  <ul class="collapse">
  <li><a href="#conceptual-diagram" id="toc-conceptual-diagram" class="nav-link" data-scroll-target="#conceptual-diagram"><span class="header-section-number">10.1.1</span> Conceptual diagram</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">10.2</span> Data</a>
  <ul class="collapse">
  <li><a href="#site-info-and-event-data" id="toc-site-info-and-event-data" class="nav-link" data-scroll-target="#site-info-and-event-data"><span class="header-section-number">10.2.1</span> Site info and event data</a></li>
  <li><a href="#visualize-gg-relationships" id="toc-visualize-gg-relationships" class="nav-link" data-scroll-target="#visualize-gg-relationships"><span class="header-section-number">10.2.2</span> Visualize g~G relationships</a></li>
  <li><a href="#examine-hysteresis" id="toc-examine-hysteresis" class="nav-link" data-scroll-target="#examine-hysteresis"><span class="header-section-number">10.2.3</span> Examine hysteresis</a></li>
  </ul></li>
  <li><a href="#declare-model" id="toc-declare-model" class="nav-link" data-scroll-target="#declare-model"><span class="header-section-number">10.3</span> Declare model</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model"><span class="header-section-number">10.4</span> Fit the model</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics"><span class="header-section-number">10.5</span> Model diagnostics</a>
  <ul class="collapse">
  <li><a href="#view-r-hat" id="toc-view-r-hat" class="nav-link" data-scroll-target="#view-r-hat"><span class="header-section-number">10.5.1</span> View R-hat</a></li>
  <li><a href="#view-traceplots" id="toc-view-traceplots" class="nav-link" data-scroll-target="#view-traceplots"><span class="header-section-number">10.5.2</span> View traceplots</a></li>
  <li><a href="#pp-check" id="toc-pp-check" class="nav-link" data-scroll-target="#pp-check"><span class="header-section-number">10.5.3</span> PP check</a></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection"><span class="header-section-number">10.5.4</span> Model selection</a></li>
  </ul></li>
  <li><a href="#plot-model-output" id="toc-plot-model-output" class="nav-link" data-scroll-target="#plot-model-output"><span class="header-section-number">10.6</span> Plot model output</a>
  <ul class="collapse">
  <li><a href="#slope-int.-correlation" id="toc-slope-int.-correlation" class="nav-link" data-scroll-target="#slope-int.-correlation"><span class="header-section-number">10.6.1</span> Slope-int. correlation</a></li>
  <li><a href="#effect-of-g-on-g" id="toc-effect-of-g-on-g" class="nav-link" data-scroll-target="#effect-of-g-on-g"><span class="header-section-number">10.6.2</span> Effect of G on g</a></li>
  <li><a href="#within-site-variation" id="toc-within-site-variation" class="nav-link" data-scroll-target="#within-site-variation"><span class="header-section-number">10.6.3</span> Within-site variation</a></li>
  <li><a href="#among-site-variation" id="toc-among-site-variation" class="nav-link" data-scroll-target="#among-site-variation"><span class="header-section-number">10.6.4</span> Among-site variation</a></li>
  <li><a href="#portfolio-strength" id="toc-portfolio-strength" class="nav-link" data-scroll-target="#portfolio-strength"><span class="header-section-number">10.6.5</span> Portfolio strength</a></li>
  <li><a href="#attenuation-strength" id="toc-attenuation-strength" class="nav-link" data-scroll-target="#attenuation-strength"><span class="header-section-number">10.6.6</span> Attenuation Strength</a></li>
  </ul></li>
  <li><a href="#deprecated" id="toc-deprecated" class="nav-link" data-scroll-target="#deprecated"><span class="header-section-number">10.7</span> DEPRECATED</a>
  <ul class="collapse">
  <li><a href="#agnostic-to-sites" id="toc-agnostic-to-sites" class="nav-link" data-scroll-target="#agnostic-to-sites"><span class="header-section-number">10.7.1</span> Agnostic to sites</a></li>
  <li><a href="#porfolio-strength" id="toc-porfolio-strength" class="nav-link" data-scroll-target="#porfolio-strength"><span class="header-section-number">10.7.2</span> Porfolio strength</a></li>
  <li><a href="#attenuation-strength-1" id="toc-attenuation-strength-1" class="nav-link" data-scroll-target="#attenuation-strength-1"><span class="header-section-number">10.7.3</span> Attenuation strength</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Event Delineation/WeeklySummary.html">Big G-Little g</a></li><li class="breadcrumb-item"><a href="../Big G Little g/WedgeModel.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Wedge Model</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Wedge Model</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Purpose: Define the Wedge hypothesis and model in JAGS.</p>
<section id="q-h-a" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="q-h-a"><span class="header-section-number">10.1</span> Q, H, A</h2>
<p><strong>Questions:</strong></p>
<ol type="1">
<li>How does water availability (G) affect <em>upstream</em> diversity in streamflow regimes (g)?
<ol type="a">
<li>How does streamflow diversity manifest as heterogeneity <em>within</em> and <em>among</em> locations in the upstream river network?</li>
</ol></li>
<li>What are the relative contributions of within- and among-site diversity to the total streamflow diversity across the river network and does this change with water availability?</li>
</ol>
<p><strong>The Wedge Hypothesis:</strong> Among- and within-site diversity in g response to G drive spatiotemporal variation in flow across river networks</p>
<ol type="1">
<li>Among-site wedge: heterogeneity in physical characteristics among sites diversify little g response during low flows, but diversity in little g response attenuates (decreases) during high flows</li>
<li>Within-site wedge: within sites, variation in little g response to G is greater at low flows than at high flows</li>
<li>Additive diversity in the response of little g to Big G among and within sites drives total streamflow diversity across river networks</li>
</ol>
<p><strong>Approach</strong></p>
<ol type="1">
<li>Break up data into manageable chunks using event/non-event delineation
<ol type="a">
<li>Using Big G flow time series data, perform baseflow separation and event delineation to break up data into event and intervening non-event (baseflow) periods.</li>
<li>Apply Big G event/non-event periods to corresponding little g time series data and calculate (log) volumetric yield during each period for both G and g.</li>
</ol></li>
<li>Using a Bayesian hierarchical model to account for site-level variation, model g ~ G, where g is (log) volumetric yield at little g and G is (log) volumetric yield at Big G during successive event/non-event periods.
<ol type="a">
<li>Fit site-aware and site-agnostic models to describe within- and among-site diversity in g response to G, respectively.</li>
<li>Derive measures of observed and expected g variance dampening with increasing G under different assumptions regarding among- and within-site streamflow diversity</li>
</ol></li>
</ol>
<section id="conceptual-diagram" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="conceptual-diagram"><span class="header-section-number">10.1.1</span> Conceptual diagram</h3>
<p>The Wedge Hypothesis states that among- and within-site diversity in g response to G drive spatiotemporal variation in streamflow across entire river networks:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeHypDiag.jpg" class="img-fluid figure-img"></p>
<figcaption>The Wedge Hypothesis - general</figcaption>
</figure>
</div>
<p>The hypothesis can be represented with a relatively simple hierarchical model:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeHypDiag_Decon.jpg" class="img-fluid figure-img"></p>
<figcaption>The Wedge Hypothesis - parameters</figcaption>
</figure>
</div>
<p>From the fitted model, we can assess the relative contributions of within- and among-site diversity to total streamflow diversity across the river network and explore the extent to which this changes with water availability:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeHypDiag_Portfolio.jpg" class="img-fluid figure-img"></p>
<figcaption>The Wedge Hypothesis - portfolio strength</figcaption>
</figure>
</div>
</section>
</section>
<section id="data" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="data"><span class="header-section-number">10.2</span> Data</h2>
<section id="site-info-and-event-data" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="site-info-and-event-data"><span class="header-section-number">10.2.1</span> Site info and event data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># site information and locations</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>siteinfo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Data/EcoDrought_SiteInformation.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>siteinfo_sp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(siteinfo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(siteinfo_sp, <span class="at">zcol =</span> <span class="st">"designation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-8d58c73e41aad16cf418" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-8d58c73e41aad16cf418">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[42.449812,42.434854,42.433548,42.434289,42.436353,42.431868,42.437495,42.43738,42.456777,42.414344,38.2092,38.2073,38.2052,38.2003,38.1971,38.1974,38.1956,38.1942,38.1965,38.1986,38.7455,38.7425,38.7384,38.7341,38.728,38.7257,38.7119,38.7045,38.7013,38.467,38.463,38.4594,38.4584,38.4592,38.4565,38.4535,38.4487,38.4464,38.4445,48.60295393,48.59770263,48.5749299,48.70570043,48.66182217,48.67441677,48.6658175,48.6687146,48.69030189,48.57426599,48.60368698,48.61350039,48.61788825,48.62211721,48.59827268,48.65864917,48.5544245,48.69129511,48.57092321,48.59324223,48.27095656,45.871421,45.8757,45.90132,45.859201,46.18374,46.184537,46.170367,46.18431,46.18146,46.1671611,46.184068,43.773992,43.74895,43.73347,43.72041,43.73165,43.76467,43.77413,43.7664,43.7643,43.73664,43.7723,42.5420303,42.44990946,42.4143661,46.18480556,46.1671611,45.7383611,42.7908333,48.61005278,48.5976861,48.4957972,43.8510187,43.7331083,43.7634833,42.637425,42.64180278,42.66755,42.72374167,42.76296389,42.7640722],[-72.694017,-72.67102199999999,-72.668187,-72.671541,-72.68684500000001,-72.664232,-72.676016,-72.68165999999999,-72.688199,-72.62929200000001,-78.7527,-78.75700000000001,-78.7612,-78.76560000000001,-78.7687,-78.77370000000001,-78.77800000000001,-78.7837,-78.7886,-78.7931,-78.2818,-78.2855,-78.2893,-78.2916,-78.2916,-78.28360000000001,-78.27719999999999,-78.2704,-78.26739999999999,-78.4177,-78.4101,-78.4036,-78.3995,-78.38720000000001,-78.3809,-78.379,-78.37820000000001,-78.3759,-78.3707,-114.187,-114.225,-114.317,-114.455,-114.242,-114.317,-114.245,-114.267,-114.276,-114.317,-114.187,-114.202,-114.067,-114.074,-114.04,-114.236,-114.375,-114.376,-114.312,-114.368,-113.944,-110.24438,-110.24775,-110.24998,-110.877075,-110.384631,-110.407337,-110.456856,-110.3798,-110.3592,-110.5542861,-110.379446,-110.235541,-110.31903,-110.31434,-110.3703,-110.315264,-110.32339,-110.235348,-110.44859,-110.32384,-110.31387,-110.4804,-72.69370179000001,-72.6935489,-72.6287562,-110.3796389,-110.5542861,-110.4794694,-118.8675,-114.3819278,-114.2247194,-114.1267639,-110.5171751,-110.3145611,-110.3237861,-118.7607722,-118.7589944,-118.76015,-118.8330667,-118.843111,-118.8423167],6,null,"siteinfo_sp - designation",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#4B0055","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#4B0055","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#4B0055","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#009B95","#4B0055","#FDE333","#FDE333","#FDE333","#FDE333","#4B0055","#4B0055","#FDE333","#FDE333","#4B0055","#4B0055","#FDE333","#FDE333","#FDE333","#FDE333","#FDE333","#FDE333","#FDE333","#FDE333"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>AB&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Avery Brook&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171000&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.8322503&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 699.2518&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>JB&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Jimmy Brook&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171040&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.9743054&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 452.0916&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>MB&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Mitchell Brook&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171080&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.3514676&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 437.5512&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>OL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Obear Brook Lower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171070&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.5654137&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 465.1764&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SD&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Sanderson Brook&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171010&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.7567871&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 640.4320&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>West Brook Lower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171090&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   8.5098116&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 401.9724&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WU&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>West Brook Upper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171030&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   6.3540403&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 516.3184&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WR&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>West Brook Reservoir&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171020&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   6.2101754&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 568.7790&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WW&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>West Whately Brook&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171005&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.4928159&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 686.2488&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WM&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>West Brook 0&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171100&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  11.3860459&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 154.5905&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_01FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 01&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0162732260&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.6700740&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1840.9670&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_02FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 02&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0162732518&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.9912138&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1770.2417&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_03FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 03&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0162732782&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.2384319&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1708.7624&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_04FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 04&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0162733238&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.5651468&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1634.2663&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_05FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 05&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0162734220&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.3149357&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1587.6120&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_06FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 06&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01627352&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.8534416&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1552.5478&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_07FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 07&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01627358&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.0594680&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1520.2334&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_08FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 08&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0162737249&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.5932435&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1474.8519&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_09FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 09&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01627380&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.0467174&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1433.8870&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PA_10FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Paine Run 10&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01627400&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Paine Run&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.8965855&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1400.3952&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_01FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 01&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166235777&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.5466476&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2501.9557&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_02FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 02&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166235998&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.1006113&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2369.7393&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>23&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_03FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 03&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236114&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.4355099&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2162.4096&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>24&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_04FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 04&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236168&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.8095900&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2024.9685&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_05FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 05&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236224&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.3054298&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1874.3122&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>26&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_06FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 06&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236285&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.6988937&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1603.3088&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_08FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 08&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236472&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.6105641&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1354.6080&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>28&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_09FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 09&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236559&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.2830953&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1238.9199&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>29&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PI_10FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Piney River 10&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166236713&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Piney River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.8079952&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1183.1180&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_01FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 01&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526050&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.4772281&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2940.0147&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>31&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_02FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 02&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526110&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   0.8271327&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2487.8920&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>32&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_03FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 03&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526165&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.2444908&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2199.2577&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_04FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 04&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526303&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.9000379&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>2053.1192&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>34&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_05FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 05&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526399&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.4754040&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1710.9466&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_06FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 06&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526453&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.8062837&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1524.8785&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>36&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_07FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 07&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526484&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.9037810&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1432.0669&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>37&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_08FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 08&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526535&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.1630527&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1265.5245&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>38&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_09FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 09&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526567&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.2551121&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>1154.3350&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>39&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SR_10FL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Staunton River 10&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>0166526910&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shen&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Staunton River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.1061151&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 996.5581&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>40&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_001&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>BigCreekLower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  81.2083617&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3428.6560&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>41&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_004&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>BigCreekMiddle&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  73.5768438&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3528.9551&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>42&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_005&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>BigCreekUpper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  53.1555778&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3913.1550&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>43&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_009&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CoalCreekHeadwaters&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  12.4254748&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4595.6775&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>44&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_001&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CoalCreekLower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  59.9694259&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3658.9180&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>45&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_006&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CoalCreekMiddle&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  45.3748041&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3874.4946&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>46&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_003&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CycloneCreekLower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  12.6353670&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3701.7687&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>47&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_004&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CycloneCreekMiddle&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  11.2380763&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3853.7423&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>48&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_005&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CycloneCreekUpper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   9.8960331&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4039.1350&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>49&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_006&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>HallowattCreekLower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  28.1074377&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3916.4062&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>50&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_002&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>LangfordCreekLower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.9917383&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3431.6910&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>51&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_003&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>LangfordCreekUpper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.8629722&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3594.2884&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>52&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>MCG_002&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>McGeeCreekLower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>McGee Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   7.4164591&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3711.2340&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>53&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>MCG_001&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>McGeeCreekTrib&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>McGee Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.2240208&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3697.0725&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>54&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>MCG_003&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>McGeeCreekUpper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>McGee Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.3382493&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3866.2909&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>55&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_002&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>MeadowCreek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   5.7153134&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3684.4886&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>56&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_008&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>NicolaCreek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.3459243&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4958.1863&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>57&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>COA_008&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>CoalCreekNorth&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Coal Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  20.8457145&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4154.4794&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>58&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_007&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>SkookoleelCreek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   8.5886199&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3965.1819&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>59&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG_009&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>WernerCreek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.9795282&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4284.3249&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>60&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WBU_001&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>WoundedBuckCreek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Wounded Buck Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  14.9307167&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3635.3053&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>61&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DU01&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>EF Duck Creek be HF&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Duck Creek&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Duck Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   9.4495375&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5342.4715&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>62&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DU02&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>EF Duck Creek ab HF&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Duck Creek&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Duck Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   5.4605992&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5429.5483&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>63&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DU03&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Henrys Fork&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Duck Creek&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Duck Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.6960835&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5926.9079&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>64&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH01&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Brackett Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  14.8352631&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5768.6879&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>65&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH02&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Buck Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.4298623&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6493.8012&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>66&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH03&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Crandall Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.5338355&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6361.7450&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>67&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH04&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Deep Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   6.1986519&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6142.5211&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>68&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH05&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Dugout Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.3945376&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6496.1053&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>69&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH06&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Lodgepole Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   1.3590115&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6610.3856&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>70&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH07&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Shields River Valley Ranch&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  53.4215153&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5744.1457&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>71&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SH08&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Shields River ab Dugout&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   8.6790373&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6497.0348&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>72&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP01&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Grizzly Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  12.6823126&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>8339.7503&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>73&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP02&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Grouse Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   5.1508608&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7869.5257&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>74&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP03&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Leidy Creek Lower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   5.1718308&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7958.3398&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>75&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP04&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Leidy Creek Upper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.1816563&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>8706.8560&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>76&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP05&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Leidy Creek Mouth&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   5.1585521&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7979.3625&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>77&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP06&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>NF Spread Creek Lower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  27.9304796&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7788.5460&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>78&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP07&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>NF Spread Creek Upper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   3.6804425&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>8340.2053&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>79&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP08&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Rock Creek&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   4.7413085&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7285.9575&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>80&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP09&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>SF Spread Creek Lower&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  44.2556218&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7785.6007&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>81&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP10&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>SF Spread Creek Upper&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  35.0605919&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7937.8850&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>82&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SP11&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Spread Creek Dam&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>little&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>ECOD&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  97.4926478&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7130.2353&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>83&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SRC&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>South River Conway NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01169900&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  24.0194621&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 455.4568&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>84&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>AVB&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Avery Brook NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171000&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.8334885&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 696.2354&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>85&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>WBR&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>West Brook NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>01171100&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Mass&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>West Brook&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  11.3929050&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td> 154.1473&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>86&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DUG&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Dugout Creek NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>06192900&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   2.3849317&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6505.1692&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>87&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SRS&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Shields River ab Smith NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>06192980&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  53.4215153&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5744.1457&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>88&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SRL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Shields River nr Livingston NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>06195600&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Shields&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Shields River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td> 842.7024951&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4421.9359&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>89&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DBF&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Donner Blitzen River nr Frenchglen NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>10396000&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td> 204.9669881&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4262.8244&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>90&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>HAL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Hallowat Creek NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>12355342&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  10.0317552&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4453.6190&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>91&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>BIG&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Big Creek NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>12355347&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Big Creek&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  73.5899716&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3528.2743&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>92&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>NFF&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>North Fork Flathead River NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>12355500&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Flat&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Flathead&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>1556.0000000&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>3150.6313&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>93&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>PCM&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Pacific Creek at Moran NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>13011500&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>big&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td> 166.0160483&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>6735.2497&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>94&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>LEI&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Leidy Creek Mouth NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>13012465&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>   5.1689622&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7960.3743&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>95&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>SFS&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>SF Spread Creek Lower NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>13012475&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Snake&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Snake River&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  44.2420544&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>7789.9333&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>96&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DBI&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Donner Blitzen ab Indian NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>423815118453900&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  60.6960528&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5097.0236&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>97&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>IND&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Indian Creek NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>423830118453200&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  19.0189031&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5095.5474&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>98&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>LBL&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Little Blizten River NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>424003118453700&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  18.5136726&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>5069.1385&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>99&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DBB&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Donner Blitzen nr Burnt Car NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>424325118495900&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td> 163.5486547&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4514.4190&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>100&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>DBA&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Donner Blitzen ab Fish NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>424547118503500&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td> 175.4902236&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4340.9354&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>101&emsp;<\/td><\/tr><tr><td>1<\/td><th>site_id&emsp;<\/th><td>FSH&emsp;<\/td><\/tr><tr><td>2<\/td><th>site_name&emsp;<\/th><td>Fish Creek NWIS&emsp;<\/td><\/tr><tr><td>3<\/td><th>station_no&emsp;<\/th><td>424551118503200&emsp;<\/td><\/tr><tr><td>4<\/td><th>designation&emsp;<\/th><td>medium&emsp;<\/td><\/tr><tr><td>5<\/td><th>basin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>6<\/td><th>region&emsp;<\/th><td>Oreg&emsp;<\/td><\/tr><tr><td>7<\/td><th>subbasin&emsp;<\/th><td>Donner Blitzen&emsp;<\/td><\/tr><tr><td>8<\/td><th>source&emsp;<\/th><td>NWIS&emsp;<\/td><\/tr><tr><td>9<\/td><th>area_sqmi&emsp;<\/th><td>  22.2913828&emsp;<\/td><\/tr><tr><td>10<\/td><th>elev_ft&emsp;<\/th><td>4344.7481&emsp;<\/td><\/tr><tr><td>11<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","big","little","little","little","little","little","little","little","little","big","little","little","little","little","little","little","little","little","little","big","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","little","big","medium","medium","medium","medium","big","big","medium","medium","big","big","medium","medium","medium","medium","medium","medium","medium","medium"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-118.8675,38.1942,-72.6287562,48.70570043,true,"siteinfo_sp - designation","Zoom to siteinfo_sp - designation","<strong> siteinfo_sp - designation <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"siteinfo_sp - designation",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#009B95","#FDE333"],"labels":["big","little","medium"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"siteinfo_sp - designation","extra":null,"layerId":null,"className":"info legend","group":"siteinfo_sp - designation"}]}],"limits":{"lat":[38.1942,48.70570043],"lng":[-118.8675,-72.6287562]},"fitBounds":[38.1942,-118.8675,48.70570043,-72.6287562,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># delineated event/non-event volumetric yield data </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Event Delineation/EcoDrought_Data_EventNonEvent_WestBrookonly.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook Lower"</span>, <span class="st">"Mitchell Brook"</span>, <span class="st">"Jimmy Brook"</span>, <span class="st">"Obear Brook Lower"</span>, <span class="st">"West Brook Upper"</span>, <span class="st">"West Brook Reservoir"</span>, <span class="st">"Sanderson Brook"</span>, <span class="st">"Avery Brook"</span>, <span class="st">"West Whately Brook"</span>)))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [689 Ã— 24] (S3: tbl_df/tbl/data.frame)
 $ site_name            : Factor w/ 9 levels "West Brook Lower",..: 8 8 8 8 8 8 8 8 8 8 ...
 $ basin                : chr [1:689] "West Brook" "West Brook" "West Brook" "West Brook" ...
 $ subbasin             : chr [1:689] "West Brook" "West Brook" "West Brook" "West Brook" ...
 $ agneventid           : num [1:689] 5 6 7 8 9 10 11 12 13 14 ...
 $ eventlen             : num [1:689] 6 5 5 5 4 2 4 4 11 6 ...
 $ mindate              : Date[1:689], format: "2020-02-20" "2020-02-26" ...
 $ isevent              : num [1:689] 2 1 1 2 1 2 1 2 1 2 ...
 $ yield_little_cum     : num [1:689] 8.57 23.21 18.74 15.54 14.08 ...
 $ yield_big_cum        : num [1:689] 7.04 17.14 11.93 9.41 10.16 ...
 $ yield_little_cum_log : num [1:689] 2.15 3.14 2.93 2.74 2.64 ...
 $ yield_big_cum_log    : num [1:689] 1.95 2.84 2.48 2.24 2.32 ...
 $ xxx_little           : num [1:689] 8.51 23.16 18.69 15.49 14.04 ...
 $ yyy_little           : num [1:689] 8.51 23.16 18.69 15.49 14.04 ...
 $ yield_little_mean_log: num [1:689] 0.35 1.37 1.3 1.13 1.23 ...
 $ yield_big_mean_log   : num [1:689] 0.154 1.124 0.859 0.632 0.909 ...
 $ yield_little_q25_log : num [1:689] 0.274 0.985 1.175 1.081 1.059 ...
 $ yield_little_q50_log : num [1:689] 0.351 1.105 1.3 1.109 1.178 ...
 $ yield_little_q75_log : num [1:689] 0.366 1.487 1.369 1.205 1.353 ...
 $ yield_big_q25_log    : num [1:689] 0.0675 0.814 0.7804 0.602 0.7835 ...
 $ yield_big_q50_log    : num [1:689] 0.195 0.98 0.81 0.624 0.955 ...
 $ yield_big_q75_log    : num [1:689] 0.247 1.41 0.915 0.655 1.081 ...
 $ site_name_cd         : num [1:689] 8 8 8 8 8 8 8 8 8 8 ...
 $ z_yield_big_cum_log  : num [1:689] 0.284 0.868 0.63 0.475 0.525 ...
 $ z_yield_big_mean_log : num [1:689] 0.434 1.24 1.019 0.831 1.061 ...</code></pre>
</div>
</div>
</section>
<section id="visualize-gg-relationships" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="visualize-gg-relationships"><span class="header-section-number">10.2.2</span> Visualize g~G relationships</h3>
<p>View relationship between Big G and little g, color by site, facet by event/non-event.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">isevent =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(isevent, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Event"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Baseflow"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yield_big_cum_log, <span class="at">y =</span> yield_little_cum_log, <span class="at">group =</span> site_name, <span class="at">color =</span> site_name)) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>isevent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods.</figcaption>
</figure>
</div>
</div>
</div>
<p>View relationship between Big G and little g, color by event/non-event, facet by site. For most sites (except may Obear Brook), G-g relationships are identical between events and non-event.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">isevent =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(isevent, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Event"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Baseflow"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yield_big_cum_log, <span class="at">y =</span> yield_little_cum_log, <span class="at">group =</span> isevent, <span class="at">color =</span> isevent)) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="examine-hysteresis" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3" class="anchored" data-anchor-id="examine-hysteresis"><span class="header-section-number">10.2.3</span> Examine hysteresis</h3>
<p>Does the g~G relationship change over time?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doy =</span> <span class="fu">yday</span>(mindate)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yield_big_cum_log, <span class="at">y =</span> yield_little_cum_log, <span class="at">color =</span> doy)) <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">midpoint =</span> <span class="dv">182</span>, <span class="at">low =</span> <span class="st">"orange"</span>, <span class="at">mid =</span> <span class="st">"purple3"</span>, <span class="at">high =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods. Points colored by day of year.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">ifelse</span>(<span class="fu">month</span>(mindate) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="st">"winter"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(<span class="fu">month</span>(mindate) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), <span class="st">"spring"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(<span class="fu">month</span>(mindate) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>), <span class="st">"summer"</span>, <span class="st">"autumn"</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yield_big_cum_log, <span class="at">y =</span> yield_little_cum_log, <span class="at">group =</span> season, <span class="at">color =</span> season)) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>site_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods, by season.</figcaption>
</figure>
</div>
</div>
</div>
<p>Yes, it does appear that the relationship between g and G changes is time-dependent, potentially motivating some inclusion of time as a covariate (and interaction with big G effectâ€¦circular regression?). However, this also likely drives the shape/existence of the little wedges. So, is it necessary to account for?</p>
</section>
</section>
<section id="declare-model" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="declare-model"><span class="header-section-number">10.3</span> Declare model</h2>
<p>Based on results above, there does not appear to be any significant difference in the G-g relationship for event and non-event periods. Therefore, do not include random intercepts/slopes (by event/non-event) in the model. Previously, I tried to estimate the G-g differences using an intercept model, with the magnitude of difference a function of water availability. However, when Q = Qg, this simplified to a linear regression between Qg (dependent var.) and QG (independent var.), which is ultimately what is of interest. I estimate this regression model below:</p>
<p>Correlation between site-level slopes and site-level intercepts is modeled as specified on pgs. 362 and 376 in Gelman and Hill (2007).</p>
<ul>
<li>Data
<ul>
<li><em>Qg</em>: log volumetric yield at little g</li>
<li><em>sites</em>: numeric site id</li>
<li><em>QG</em>: log volumetric yield at Big G</li>
<li><em>nObs</em>: number of observations</li>
<li><em>nSites</em>: number of sites (little g sites)</li>
</ul></li>
<li>Parameters
<ul>
<li><em>alpha</em>: site-level intercept</li>
<li><em>beta</em>: site-level effect of Big G on little g (slope)</li>
<li><em>alpha.mu</em>: global intercept</li>
<li><em>beta.mu</em>: global effect of Big G on little g (slope)</li>
<li><em>alpha.sigma</em>: site-level variability in the intercept</li>
<li><em>beta.sigma</em>: site-level variability in the slope</li>
<li><em>sig.alpha</em>: site-level intercept for process error</li>
<li><em>sig.beta</em>: site-level effect of Big G on process error (slope)</li>
<li><em>sig.alpha.mu</em>: global process error intercept</li>
<li><em>sig.beta.mu</em>: global process error slope</li>
<li><em>sig.alpha.sigma</em>: site-level variability in process error intercept</li>
<li><em>sig.beta.sigma</em>: site-level variability in process error slope</li>
<li><em>rho</em>: correlation between site-leve intercepts (<em>alpha</em>) and slopes (<em>beta</em>)</li>
</ul></li>
<li>Derived values
<ul>
<li><em>predlg</em>: predicted little g</li>
<li><em>diff</em>: difference between predicted little g and Big G</li>
<li><em>VpObs</em>: observed population variance, conditional on x</li>
<li><em>VpScen1</em>: expected population variance, no within or among-site diversity</li>
<li><em>VpScen2</em>: expected population variance, no within-site diversity</li>
<li><em>VpScen3</em>: expected population variance, no among-size diversity</li>
<li><em>port1</em>, <em>port2</em>, <em>port3</em>: predicted portfolio strength (over a range of G) compared to 3 alternative hypotheses</li>
<li><em>attenObs</em>, <em>atten1</em>, <em>atten2</em>, <em>atten3</em>: attentuation strength (â€œwedginessâ€) of observed data and expected under 3 alternative hypotheses</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:nObs) {</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">  Qg[i] ~ dnorm(mu[i], pow(sigma[i], -2))</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">  mu[i] &lt;- alpha[sites[i]] + beta[sites[i]] * QG[i]</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">  log(sigma[i]) &lt;- sig.alpha[sites[i]] + sig.beta[sites[i]] * QG[i]</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">  # Log-likelihood</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">  loglik[i] &lt;- logdensity.norm(Qg[i], mu[i], pow(sigma[i], -2))</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">  ## SITE AGNOSTIC</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">  Qg2[i] ~ dnorm(ag.mu[i], pow(ag.sigma[i], -2))</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">  ag.mu[i] &lt;- ag.alpha + ag.beta * QG[i]</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">  log(ag.sigma[i]) &lt;- ag.sig.alpha + ag.sig.beta * QG[i]  </span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="st">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="st"># Site-specific parameters</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:nSites) {</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="st">    alpha[j] &lt;- B[j,1]</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="st">    beta[j] &lt;- B[j,2]</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="st">    B[j,1:2] ~ dmnorm(B.hat[j,], Tau.B[,])</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="st">    B.hat[j,1] &lt;- alpha.mu</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="st">    B.hat[j,2] &lt;- beta.mu</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="st">    sig.alpha[j] ~ dnorm(sig.alpha.mu, pow(sig.alpha.sigma, -2))</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="st">    sig.beta[j] ~ dnorm(sig.beta.mu, pow(sig.beta.sigma, -2))</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="st"># global parameters</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="st">alpha.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="st">beta.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="st">sig.alpha.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="st">sig.beta.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="st"># variance-covariance matrix components</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="st">Tau.B[1:2,1:2] &lt;- inverse(Sigma.B[,])</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[1,1] &lt;- pow(alpha.sigma, 2)</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[2,2] &lt;- pow(beta.sigma, 2)</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[1,2] &lt;- rho * alpha.sigma * beta.sigma</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[2,1] &lt;- Sigma.B[1,2]</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="st">alpha.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="st">beta.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="st">rho ~ dunif(-1,1)</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="st"># among-site variation in sigma parameters</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="st">sig.alpha.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="st">sig.beta.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="st">## SITE AGNOSTIC</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="st">ag.alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="st">ag.beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="st">ag.sig.alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="st">ag.sig.beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="st">##--- DERIVED VALUES ------------------------------------------------##</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="st"># expected deviation from Big G</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:nSites) { </span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:nDiff) {</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="st">    predlg[j,i] &lt;- alpha[j] + beta[j] * QGvec[i]</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="st">    diff[j,i] &lt;- (alpha[j] + beta[j] * QGvec[i]) - QGvec[i]</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="st">  }}</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="st"># variance decomposition and standardization</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:nDiff) {</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="st">  # observed population variance, conditional on x</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="st">  VpObs[i] &lt;- ((beta.mu^2) * varx) + ((alpha.sigma^2) + ((QGvec[i]^2) * (beta.sigma^2)) + (2 * QGvec[i] * (rho * alpha.sigma * beta.sigma))) + ((exp(sig.alpha.mu + sig.beta.mu * QGvec[i]))^2)</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="st">  # expected population variance, no within or among-site diversity</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="st">  VpScen1[i] &lt;- ((beta.mu^2) * varx) + ((exp(sig.alpha.mu))^2)</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="st">  # expected population variance, no within-site diversity</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="st">  VpScen2[i] &lt;- ((beta.mu^2) * varx) + ((alpha.sigma^2) + ((QGvec[i]^2) * (beta.sigma^2)) + (2 * QGvec[i] * (rho * alpha.sigma * beta.sigma))) + ((exp(sig.alpha.mu))^2)</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="st">  # expected population variance, no among-size diversity</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="st">  VpScen3[i] &lt;- ((beta.mu^2) * varx) + ((exp(sig.alpha.mu + sig.beta.mu * QGvec[i]))^2)</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="st">  # portfolio strength: how much more diversity in streamflow do we observe at the little g gages than expected under alternative (null) hypotheses?</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="st">  port1[i] &lt;- VpObs[i] / VpScen1[i]</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="st">  port2[i] &lt;- VpObs[i] / VpScen2[i]</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="st">  port3[i] &lt;- VpObs[i] / VpScen3[i]</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="st">  # variance in raw response values, agnostic to site (i.e., variance in the sample)</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="st">  VarAg[i] &lt;- (exp(ag.sig.alpha + ag.sig.beta * QGvec[i]))^2</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="st">  Vf[i] &lt;- (beta.mu^2) * varx</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="st">  Vix[i] &lt;- (alpha.sigma^2) + ((QGvec[i]^2) * (beta.sigma^2)) + (2 * QGvec[i] * (rho * alpha.sigma * beta.sigma))</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="st">  Vr[i] &lt;- (exp(sig.alpha.mu + sig.beta.mu * QGvec[i]))^2</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="st"># attenuation strength: how much more diversity in streamflow (among little g gages) do we observe at low vs. high flows?</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="st">attenObs &lt;- VpObs[1] / VpObs[nDiff]</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="st">atten1 &lt;- VpScen1[1] / VpScen1[nDiff]</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="st">atten2 &lt;- VpScen2[1] / VpScen2[nDiff]</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="st">atten3 &lt;- VpScen3[1] / VpScen3[nDiff]</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>, <span class="at">file =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2_corr.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fit-the-model" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="fit-the-model"><span class="header-section-number">10.4</span> Fit the model</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vector of QG for prediction</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ndiff <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>QGvec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># gather data for JAGS</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"nObs"</span> <span class="ot">=</span> <span class="fu">dim</span>(dat)[<span class="dv">1</span>], <span class="st">"nSites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd)), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"sites"</span> <span class="ot">=</span> dat<span class="sc">$</span>site_name_cd, <span class="co">#"indev" = dat_wb2$isevent,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Qg"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, <span class="st">"QG"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_big_cum_log, <span class="st">"Qg2"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"QGvec"</span> <span class="ot">=</span> QGvec, <span class="st">"nDiff"</span> <span class="ot">=</span> ndiff, <span class="st">"varx"</span> <span class="ot">=</span> <span class="fu">var</span>(dat<span class="sc">$</span>yield_big_cum_log))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters to monitor</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"alpha.mu"</span>, <span class="st">"beta.mu"</span>, <span class="st">"alpha.sigma"</span>, <span class="st">"beta.sigma"</span>, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sig.alpha"</span>, <span class="st">"sig.beta"</span>, <span class="st">"sig.alpha.mu"</span>, <span class="st">"sig.beta.mu"</span>, <span class="st">"sig.alpha.sigma"</span>, <span class="st">"sig.beta.sigma"</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rho"</span>, <span class="st">"diff"</span>, <span class="st">"predlg"</span>, <span class="st">"loglik"</span>, <span class="st">"mu"</span>, <span class="st">"Qg"</span>, </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"VpObs"</span>, <span class="st">"VpScen1"</span>, <span class="st">"VpScen2"</span>, <span class="st">"VpScen3"</span>, <span class="st">"port1"</span>, <span class="st">"port2"</span>, <span class="st">"port3"</span>, <span class="st">"attenObs"</span>, <span class="st">"atten1"</span>, <span class="st">"atten2"</span>, <span class="st">"atten3"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"VarAg"</span>, <span class="st">"Vf"</span>, <span class="st">"Vix"</span>, <span class="st">"Vr"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># initial values</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>myinits <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">alpha.mu =</span> <span class="dv">0</span>, <span class="at">beta.mu =</span> <span class="dv">1</span>, <span class="at">alpha.sigma =</span> <span class="dv">1</span>, <span class="at">beta.sigma =</span> <span class="fl">0.1</span>, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">sig.alpha.mu =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">sig.beta.mu =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">sig.alpha.sigma =</span> <span class="fl">0.4</span>, <span class="at">sig.beta.sigma =</span> <span class="fl">0.05</span>, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">ag.alpha =</span> <span class="fl">0.3</span>, <span class="at">ag.beta =</span> <span class="dv">1</span>, <span class="at">ag.sig.alpha =</span> <span class="dv">0</span>, <span class="at">ag.sig.beta =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">rho =</span> <span class="sc">-</span><span class="fl">0.8</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># run in jags</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>mod_0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> myinits, <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model.file =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2_corr.txt"</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">50</span>, <span class="at">n.burnin =</span> <span class="dv">4000</span>, <span class="at">n.iter =</span> <span class="dv">14000</span>, <span class="at">DIC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(mod_0, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/Fitted models/GgMod_Events.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get MCMC samples and summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> mod_0</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>Mcmcdat_0 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>param.summary_0 <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          mean sd     2.5%      25%      50%      75%    97.5% Rhat n.eff
Qg[1] 2.148762  0 2.148762 2.148762 2.148762 2.148762 2.148762    1     1
Qg[2] 3.144685  0 3.144685 3.144685 3.144685 3.144685 3.144685    1     1
Qg[3] 2.930699  0 2.930699 2.930699 2.930699 2.930699 2.930699    1     1
Qg[4] 2.743658  0 2.743658 2.743658 2.743658 2.743658 2.743658    1     1
Qg[5] 2.644678  0 2.644678 2.644678 2.644678 2.644678 2.644678    1     1
Qg[6] 1.624893  0 1.624893 1.624893 1.624893 1.624893 1.624893    1     1</code></pre>
</div>
</div>
</section>
<section id="model-diagnostics" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="model-diagnostics"><span class="header-section-number">10.5</span> Model diagnostics</h2>
<section id="view-r-hat" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="view-r-hat"><span class="header-section-number">10.5.1</span> View R-hat</h3>
<p>Any problematic R-hat values (&gt;1.01)?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.01</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> loglik[452]    port1[65]    port1[66]    port1[67]    port1[68]    port1[69] 
    1.010080     1.010151     1.010424     1.010663     1.010867     1.011032 
   port1[70]    port1[71]    port1[72]    port1[73]    port1[74]    port1[75] 
    1.011159     1.011246     1.011293     1.011301     1.011272     1.011207 
   port1[76]    port1[77]    port1[78]    port1[79]    port1[80]    port1[81] 
    1.011109     1.010981     1.010826     1.010648     1.010450     1.010234 
   port1[82]    port3[61]    port3[62]    port3[63]    port3[64]    port3[65] 
    1.010006     1.010254     1.010789     1.011316     1.011829     1.012322 
   port3[66]    port3[67]    port3[68]    port3[69]    port3[70]    port3[71] 
    1.012787     1.013219     1.013611     1.013956     1.014251     1.014489 
   port3[72]    port3[73]    port3[74]    port3[75]    port3[76]    port3[77] 
    1.014668     1.014785     1.014839     1.014830     1.014760     1.014629 
   port3[78]    port3[79]    port3[80]    port3[81]    port3[82]    port3[83] 
    1.014444     1.014207     1.013924     1.013600     1.013243     1.012857 
   port3[84]    port3[85]    port3[86]    port3[87]    port3[88]    port3[89] 
    1.012449     1.012026     1.011591     1.011152     1.010712     1.010275 
predlg[1,33] 
    1.026732 </code></pre>
</div>
</div>
</section>
<section id="view-traceplots" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="view-traceplots"><span class="header-section-number">10.5.2</span> View traceplots</h3>
<p>For global parameters and hyperparameters onlyâ€¦</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(mod_0, <span class="at">ind =</span> <span class="cn">TRUE</span>, <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"alpha.mu"</span>, <span class="st">"beta.mu"</span>, <span class="st">"alpha.sigma"</span>, <span class="st">"beta.sigma"</span>, <span class="st">"sig.alpha.mu"</span>, <span class="st">"sig.beta.mu"</span>, <span class="st">"sig.alpha.sigma"</span>, <span class="st">"sig.beta.sigma"</span>, <span class="st">"rho"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pp-check" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3" class="anchored" data-anchor-id="pp-check"><span class="header-section-number">10.5.3</span> PP check</h3>
<p>Get observed and expected values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat_0[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="st">"Qg"</span>)])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat_0[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="st">"mu"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bayesian p-value: values approaching 0.5 indicate lack of bias in model estimates</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4930435</code></pre>
</div>
</div>
<p>Posterior predictive check: ensure linearity and ~1:1 relationship between expected and observed (log) volumetric Qg yield</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, median) <span class="sc">~</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, median), <span class="at">xlab =</span> <span class="st">"Observed Qg"</span>, <span class="at">ylab =</span> <span class="st">"Expected Qg"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="st">"1:1"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Site-specific posterior predictive check: does the model fit some sites better than others?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">obs =</span> <span class="fu">apply</span>(ppdat_obs, <span class="dv">2</span>, median), <span class="at">exp =</span> <span class="fu">apply</span>(ppdat_exp, <span class="dv">2</span>, median), <span class="at">sitecd =</span> dat<span class="sc">$</span>site_name) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> obs, <span class="at">y =</span> exp)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>sitecd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-selection" class="level3" data-number="10.5.4">
<h3 data-number="10.5.4" class="anchored" data-anchor-id="model-selection"><span class="header-section-number">10.5.4</span> Model selection</h3>
<p>Perform model selection using leave-one-out cross-validation (LOO-CV). Does the site-aware (random slopes/random intercepts) model perform better than the site-agnostic model?</p>
<p><em>Note:</em> this will need to be updated once we add other random effects specifications. For now, use LOO-CV as an additional check on model fittingâ€¦i.e., examine Pareto k estimates.</p>
<p>Again, model is well specified for all but 1 data point (k &gt; 1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get log-likelihoods</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>loglik1 <span class="ot">&lt;-</span> mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list<span class="sc">$</span>loglik</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get relative effective sample size</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>reff1 <span class="ot">&lt;-</span> <span class="fu">relative_eff</span>(<span class="fu">exp</span>(loglik1), <span class="at">chain_id =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">4</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">5</span>,<span class="dv">200</span>), </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                                                 <span class="fu">rep</span>(<span class="dv">6</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">7</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">8</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">9</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">10</span>,<span class="dv">200</span>)))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate loo</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">&lt;-</span> <span class="fu">loo</span>(loglik1, <span class="at">r_eff =</span> reff1)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># compare</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 2000 by 689 log-likelihood matrix.

         Estimate   SE
elpd_loo   -426.9 26.6
p_loo        35.6  4.6
looic       853.7 53.2
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.8, 1.1]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     687   99.7%   230     
   (0.7, 1]   (bad)        2    0.3%   &lt;NA&gt;    
   (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="plot-model-output" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="plot-model-output"><span class="header-section-number">10.6</span> Plot model output</h2>
<section id="slope-int.-correlation" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="slope-int.-correlation"><span class="header-section-number">10.6.1</span> Slope-int. correlation</h3>
<p>Slopes and intercepts are negatively correlated (this is not unexpected, and explains the attenuation/wedge shape of the data). As noted in Gelman and Hill, the strength of the correlation between slopes and intercepts is sensitive to how the data is centered (or not). Currently, data span 0 (in log space), so this isnâ€™t really an artifact of the issues mentioned in Gelman and Hill (although if we mean centered the data this relationship does weaken slightly). It may actually make the most sense to force the intercept to be at the lowest value of log(G) (i.e., add min(log(G)) to all data, G and g). Intercepts would then represent the maximum expected variation in g during periods of lowest water availability. Alternatively, we could force the intercept to be at the highest valyes of log(G) (i.e., subtract max log(G) from all data) and test for random vs.&nbsp;fixed intercept (as suggested by Ben). Random intercepts would suggest that we still do see site-level variation in g when overall flows are high, whereas a fixed intercept would suggest minimal/no site-level variation in g at high flows. However, we do ultimately need to the slope/intercept correlation structure to do the variance decomposition.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sitib <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">site_name =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>site_name),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">slopes =</span> param.summary_0[<span class="fu">str_subset</span>(<span class="fu">rownames</span>(param.summary_0), <span class="at">pattern =</span> <span class="st">"^beta"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>],<span class="dv">5</span>],</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">intercepts =</span> param.summary_0[<span class="fu">str_subset</span>(<span class="fu">rownames</span>(param.summary_0), <span class="at">pattern =</span> <span class="st">"^alpha"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>],<span class="dv">5</span>]) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># slope-intercept scatterplot</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> sitib <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> slopes, <span class="at">y =</span> intercepts, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Site-level slope"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Site-level intercept"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># "rho" posterior density</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Mcmcdat_0[,<span class="st">"rho"</span>]) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Mcmcdat_0[, <span class="st">"rho"</span>])) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"rho"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Posterior density"</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange plots</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p2, p1, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">0.35</span>, <span class="fl">0.65</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cor.test(sitib$intercepts, sitib$slopes)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sitib <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">site_name =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>site_name),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">slopes =</span> param.summary_0[<span class="fu">str_subset</span>(<span class="fu">rownames</span>(param.summary_0), <span class="at">pattern =</span> <span class="st">"^sig.beta"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>],<span class="dv">5</span>],</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">intercepts =</span> param.summary_0[<span class="fu">str_subset</span>(<span class="fu">rownames</span>(param.summary_0), <span class="at">pattern =</span> <span class="st">"^sig.alpha"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>],<span class="dv">5</span>]) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># slope-intercept scatterplot</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> sitib <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> slopes, <span class="at">y =</span> intercepts, <span class="at">color =</span> site_name)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Site-level slope"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Site-level intercept"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># "rho" posterior density</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># p2 &lt;- tibble(Mcmcdat_0[,"rho"]) %&gt;% ggplot(aes(x = Mcmcdat_0[, "rho"])) + geom_density(color = "black", fill = "grey") + theme_bw() + xlab("rho") + ylab("Posterior density") + xlim(-1,0)</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange plots</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ggarrange(p2, p1, ncol = 2, widths = c(0.35, 0.65))</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(sitib<span class="sc">$</span>intercepts, sitib<span class="sc">$</span>slopes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  sitib$intercepts and sitib$slopes
t = 1.1218, df = 7, p-value = 0.2989
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.3695613  0.8373947
sample estimates:
      cor 
0.3903705 </code></pre>
</div>
</div>
</section>
<section id="effect-of-g-on-g" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="effect-of-g-on-g"><span class="header-section-number">10.6.2</span> Effect of G on g</h3>
<p>Here, I plot the results of the fitted model: site-specific effects of Big G yield on little g yield.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>nvals <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> nvals)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>pred_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nsim, nvals, nsites))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>pred_arr_summ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nvals, <span class="dv">3</span>, nsites))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites) {</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) {</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    pred_arr[j,,k] <span class="ot">&lt;-</span> Mcmcdat_0[j,<span class="fu">paste</span>(<span class="st">"alpha["</span>, k, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)] <span class="sc">+</span> Mcmcdat_0[j,<span class="fu">paste</span>(<span class="st">"beta["</span>, k, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)] <span class="sc">*</span> x_seq</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  pred_arr_summ[,<span class="dv">1</span>,k] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_arr[,,k], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  pred_arr_summ[,<span class="dv">2</span>,k] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_arr[,,k], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  pred_arr_summ[,<span class="dv">3</span>,k] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_arr[,,k], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">11</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>gg_color_hue <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  hues <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="at">length =</span> n <span class="sc">+</span> <span class="dv">1</span>) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hcl</span>(<span class="at">h =</span> hues, <span class="at">l =</span> <span class="dv">65</span>, <span class="at">c =</span> <span class="dv">100</span>)[<span class="dv">1</span><span class="sc">:</span>n] }</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">gg_color_hue</span>(<span class="dv">9</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># combined</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">range</span>(pred_arr)[<span class="dv">1</span>], <span class="at">to =</span> <span class="fu">range</span>(pred_arr)[<span class="dv">2</span>], <span class="at">length.out =</span> nvals) <span class="sc">~</span> x_seq, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"(log) volumetric yield at little g"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites) { </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(x_seq, <span class="fu">rev</span>(x_seq)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_summ[,<span class="dv">1</span>,k], <span class="fu">rev</span>(pred_arr_summ[,<span class="dv">3</span>,k])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[k], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(pred_arr_summ[,<span class="dv">2</span>,k] <span class="sc">~</span> x_seq, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> mycols[k])</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(yield_little_cum_log <span class="sc">~</span> yield_big_cum_log, <span class="at">data =</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(site_name_cd <span class="sc">==</span> k), <span class="at">col =</span> mycols[k])</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="st">"1:1"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.55</span>, <span class="dv">0</span>), <span class="at">legend =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>site_name), <span class="at">fill =</span> <span class="fu">alpha</span>(mycols, <span class="fl">0.5</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Effect of (log) volumetric yield at Big G on (log) cumulative yield at little g.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="within-site-variation" class="level3" data-number="10.6.3">
<h3 data-number="10.6.3" class="anchored" data-anchor-id="within-site-variation"><span class="header-section-number">10.6.3</span> Within-site variation</h3>
<p>Here, I plot the effect of Big G yield on site-level variation in little g (i.e., sigma). How does site-specific variation in little g response to big G attenuate with increasing Big G?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>nvals <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> nvals)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>pred_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nsim, nvals, nsites))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>pred_arr_summ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, nvals, nsites))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites) {</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) {</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    pred_arr[j,,k] <span class="ot">&lt;-</span> (<span class="fu">exp</span>(Mcmcdat_0[j,<span class="fu">paste</span>(<span class="st">"sig.alpha["</span>, k, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)] <span class="sc">+</span> Mcmcdat_0[j,<span class="fu">paste</span>(<span class="st">"sig.beta["</span>, k, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)] <span class="sc">*</span> x_seq))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nvals) {</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    pred_arr_summ[<span class="dv">1</span>,i,k] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr[,i,k], <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    pred_arr_summ[<span class="dv">2</span>,i,k] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr[,i,k], <span class="at">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    pred_arr_summ[<span class="dv">3</span>,i,k] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr[,i,k], <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">11</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>gg_color_hue <span class="ot">&lt;-</span> <span class="cf">function</span>(n) { </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  hues <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">375</span>, <span class="at">length =</span> n <span class="sc">+</span> <span class="dv">1</span>) </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hcl</span>(<span class="at">h =</span> hues, <span class="at">l =</span> <span class="dv">65</span>, <span class="at">c =</span> <span class="dv">100</span>)[<span class="dv">1</span><span class="sc">:</span>n] }</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">gg_color_hue</span>(<span class="dv">9</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co"># polygons as 95% CIs</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fu">range</span>(pred_arr_summ)[<span class="dv">2</span>], <span class="at">length.out =</span> nvals) <span class="sc">~</span> x_seq, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Within-site variation in little g, sigma"</span>)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites) { </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(x_seq, <span class="fu">rev</span>(x_seq)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_summ[<span class="dv">1</span>,,k], <span class="fu">rev</span>(pred_arr_summ[<span class="dv">3</span>,,k])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[k], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(pred_arr_summ[<span class="dv">2</span>,,k] <span class="sc">~</span> x_seq, <span class="at">col =</span> mycols[k], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">inset =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.55</span>, <span class="dv">0</span>), <span class="at">legend =</span> <span class="fu">levels</span>(dat<span class="sc">$</span>site_name), <span class="at">fill =</span> <span class="fu">alpha</span>(mycols, <span class="fl">0.5</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Increasing water availability decreases site-level heterogeneity in little g response to Big G. Lines and polygons represent the median and 95% credible interval of the relationship for each site (color).</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="among-site-variation" class="level3" data-number="10.6.4">
<h3 data-number="10.6.4" class="anchored" data-anchor-id="among-site-variation"><span class="header-section-number">10.6.4</span> Among-site variation</h3>
<p>Here, I plot the effect of Big G yield on global (i.e., among-site) variation in little g. How does among-site variation in little g response to big G attenuate with increasing Big G? This is a derived parameter: the square root of the â€œphenotypic varianceâ€ (conditional on x) as defined in Shielzeth and Nakagawa (2022).</p>
<p>From S&amp;N: â€œWe note that the phenotypic variance VP as we calculate it here as the sum of additive variance components might differ slightly from the variance in response values as estimated from the raw data (Rights &amp; Sterba, 2020). The difference is that the sum of the variance components aims to estimate the population variance while the variance in raw response values represents to variance in the sample. Since the population variance is what is relevant to biological interpretation (de Villemereuil et al., 2018), the sum of additive components is usually preferable.â€</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get derived values</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>pred_arr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>pred_arr_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { pred_arr[j,] <span class="ot">&lt;-</span> (Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpObs"</span>)]) }</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiff) { pred_arr_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>)) }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Global variance, VpObs"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"black"</span>, <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption>Increasing water availability decreases among-site heterogeneity in little g response to Big G. Line and polygon represent the median and 95% credible interval of the relationship.</figcaption>
</figure>
</div>
</div>
</div>
<p>Visually comparing the figure above with the data/regression fits figure, it seems like there is not as much variation in VpObs with x in the plot above as there â€œshouldâ€ be. In the plot below, I directly compare the population variance (VpObs) with the sample variance (VarAg), derived from the site-agnostic model). While Schielzeth and Nakagawa (2022) state that the population and sample standard deviations (variances) may â€œdiffer slightlyâ€ (pg. 1216), the difference as plotted below seems quite large, which leads me to wonder if the variance decomposition model is specified correctlyâ€¦</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpObs"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"black"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VarAg"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"blue"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"VpObs"</span>, <span class="st">"VarAg"</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>So what drives this difference? Below I plot the three components of Vp: Vf, Vix, and Vr, and the sum of Vix and Vr. The difference in VpObs and VarAg in the plot of above is driven in large part by the constant Vf, the variance explained by the fixed effects. Note that VarAg is the <em>residual variance</em> from the site-agnostic model, and thus does not include variance explained by fixed effects. For the site-aware model, the best approximation of VarAg is Vix + Vr, the between/amomg-site variance plus the residual variance (within site).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vf</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Vf"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"Vf"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"black"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VarAg"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"blue"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Vf"</span>, <span class="st">"VarAg"</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Vix</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Vix"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"Vix"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"black"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VarAg"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"blue"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Vix"</span>, <span class="st">"VarAg"</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Vr</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Vr"</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"Vr"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"black"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VarAg"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"blue"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Vr"</span>, <span class="st">"VarAg"</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Vix + Vr</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Vix + Vr"</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"Vix"</span>)]) <span class="sc">+</span> (Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"Vr"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"black"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { <span class="fu">lines</span>((Mcmcdat_0[i, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VarAg"</span>)]) <span class="sc">~</span> QGvec, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"blue"</span>, <span class="fl">0.3</span>), <span class="at">lwd =</span> <span class="fl">0.5</span>) }</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Vix + Vr"</span>, <span class="st">"VarAg"</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Why does this matter?</p>
<ul>
<li>The best way to compare the plot of within-site variation in little g (sigma ~ G) and among-site variation in little g is probably to use the sum of Vix and Vr, ignoring Vf, as within-site variation (sigma) also effectively ignores fixed effect variance.</li>
<li>For calculation of portfolio effects, it likely does not matter as all variance scenarios contain the constant and thus the constant is divided out</li>
<li>But for calculation of attenuation strength, it appears to lead to substantial underestimates of attenuation, i.e., â€œwedginessâ€. Attenuation strength is a ratio between variation at low vs high levels of G, so when a constant is added to both the numerator and denominator, the absolute difference is the same but the relative difference can be quite different
<ul>
<li>Consider the following. 4 / 2 = 2 and 3 / 1 = 3. In both cases the absolute difference is the same (1) but the relative difference changes (2 vs.&nbsp;3).</li>
</ul></li>
</ul>
</section>
<section id="portfolio-strength" class="level3" data-number="10.6.5">
<h3 data-number="10.6.5" class="anchored" data-anchor-id="portfolio-strength"><span class="header-section-number">10.6.5</span> Portfolio strength</h3>
<p>First plot population/phenotypic variances, conditional on QG</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get derived values</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>pred_arr_VpObs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>pred_arr_VpObs_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen1_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen2_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen3_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpObs[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpObs"</span>)] </span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen1[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpScen1"</span>)] </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen2[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpScen2"</span>)] </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen3[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpScen3"</span>)] </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiff) { </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpObs_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpObs[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen1_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpScen1[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen2_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpScen2[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen3_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpScen3[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">"Dark2"</span>), <span class="st">"black"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># VpScen1</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Variance"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_VpScen1_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_VpScen1_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">1</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_VpScen1_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Scenario 1"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># VpScen2</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Variance"</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_VpScen2_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_VpScen2_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">2</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_VpScen2_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Scenario 2"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># VpScen3</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Variance"</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_VpScen3_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_VpScen3_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">3</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_VpScen3_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">3</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Scenario 3"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># VpObs</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">6</span>, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) cumulative yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Variance"</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_VpObs_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_VpObs_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">4</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_VpObs_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">4</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Observed"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="576"></p>
<figcaption>Effect of water availability (log cumulative yield at Big G) on population variance in little g expected under three alternative (null) hypotheses and for observed data.</figcaption>
</figure>
</div>
</div>
</div>
<p>Now to show portfolio strength: How much more variable is the observed data than what is expected under three (null) alternative hypotheses?</p>
<p>Note: subtracted 1 from ratios so values &gt;0 indicate the observed data is more variable than expected and values &lt;0 indicate the observed data is less variable than expected</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get derived values</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>pred_arr_Port1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>pred_arr_Port2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>pred_arr_Port3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>pred_arr_Port1_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>pred_arr_Port2_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>pred_arr_Port3_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port1[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"port1"</span>)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port2[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"port2"</span>)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port3[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"port3"</span>)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiff) { </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port1_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_Port1[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port2_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_Port2[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port3_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_Port3[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">"Dark2"</span>), <span class="st">"black"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">mgp =</span> <span class="fu">c</span>(<span class="fl">2.5</span>,<span class="dv">1</span>,<span class="dv">0</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>ylim1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.25</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>ylim2 <span class="ot">&lt;-</span> <span class="fl">1.25</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># VpScen1</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> ylim1, <span class="at">to =</span> ylim2, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) volumetric yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Portfolio strength"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_Port1_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_Port1_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">1</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_Port1_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Scenario 1"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># VpScen2</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> ylim1, <span class="at">to =</span> ylim2, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) volumetric yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Portfolio strength"</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_Port2_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_Port2_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">2</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_Port2_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Scenario 2"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co"># VpScen3</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> ylim1, <span class="at">to =</span> ylim2, <span class="at">length.out =</span> ndiff) <span class="sc">~</span> QGvec, <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"(log) volumetric yield at Big G"</span>, <span class="at">ylab =</span> <span class="st">"Portfolio strength"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(QGvec, <span class="fu">rev</span>(QGvec)), <span class="at">y =</span> <span class="fu">c</span>(pred_arr_Port3_summ[,<span class="dv">1</span>], <span class="fu">rev</span>(pred_arr_Port3_summ[,<span class="dv">3</span>])), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">3</span>], <span class="fl">0.2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pred_arr_Port3_summ[,<span class="dv">2</span>] <span class="sc">~</span> QGvec, <span class="at">col =</span> mycols[<span class="dv">3</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="st">"Scenario 3"</span>, <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="attenuation-strength" class="level3" data-number="10.6.6">
<h3 data-number="10.6.6" class="anchored" data-anchor-id="attenuation-strength"><span class="header-section-number">10.6.6</span> Attenuation Strength</h3>
<p>To what degree does diversity in streamflow regimes attenuate with increasing Big G? Attenuation strength is calculated as the variance at min G divided by variance at max G four our observed data and three alternative hypotheses. Note that for scenario 1, variance is constant over G and thus would equal 1. Therefore, a value of 1 represents no attenuation. These figures may provide a standardized approach to comparing â€œwedginessâ€ across basins.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">"Dark2"</span>), <span class="st">"black"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>) <span class="sc">~</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.5</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">100</span>), <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">xlab =</span> <span class="st">"Attenuation strength"</span>, <span class="at">ylab =</span> <span class="st">"Density"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># observed</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>obs_den <span class="ot">&lt;-</span> <span class="fu">density</span>(Mcmcdat_0[,<span class="st">"attenObs"</span>])</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>obs_den<span class="sc">$</span>y2 <span class="ot">&lt;-</span> obs_den<span class="sc">$</span>y <span class="sc">/</span> <span class="fu">max</span>(obs_den<span class="sc">$</span>y)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>obs_l <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">which</span>(obs_den<span class="sc">$</span>x <span class="sc">&gt;=</span> <span class="fu">hdi</span>(obs_den, <span class="at">credMass =</span> <span class="fl">0.95</span>)[<span class="dv">1</span>]))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>obs_h <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">which</span>(obs_den<span class="sc">$</span>x <span class="sc">&lt;</span> <span class="fu">hdi</span>(obs_den, <span class="at">credMass =</span> <span class="fl">0.95</span>)[<span class="dv">2</span>]))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(obs_den<span class="sc">$</span>x[<span class="fu">c</span>(obs_l,obs_l<span class="sc">:</span>obs_h,obs_h)]), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,obs_den<span class="sc">$</span>y2[obs_l<span class="sc">:</span>obs_h],<span class="dv">0</span>), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">4</span>], <span class="fl">0.3</span>), <span class="at">lty =</span> <span class="dv">0</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(obs_den<span class="sc">$</span>y2 <span class="sc">~</span> obs_den<span class="sc">$</span>x, <span class="at">col =</span> mycols[<span class="dv">4</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># scenario 2</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>exp_den <span class="ot">&lt;-</span> <span class="fu">density</span>(Mcmcdat_0[,<span class="st">"atten2"</span>])</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>exp_den<span class="sc">$</span>y2 <span class="ot">&lt;-</span> exp_den<span class="sc">$</span>y <span class="sc">/</span> <span class="fu">max</span>(exp_den<span class="sc">$</span>y)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>exp_l <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">which</span>(exp_den<span class="sc">$</span>x <span class="sc">&gt;=</span> <span class="fu">hdi</span>(exp_den, <span class="at">credMass =</span> <span class="fl">0.95</span>)[<span class="dv">1</span>]))</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>exp_h <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">which</span>(exp_den<span class="sc">$</span>x <span class="sc">&lt;</span> <span class="fu">hdi</span>(exp_den, <span class="at">credMass =</span> <span class="fl">0.95</span>)[<span class="dv">2</span>]))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(exp_den<span class="sc">$</span>x[<span class="fu">c</span>(exp_l,exp_l<span class="sc">:</span>exp_h,exp_h)]), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,exp_den<span class="sc">$</span>y2[exp_l<span class="sc">:</span>exp_h],<span class="dv">0</span>), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">2</span>], <span class="fl">0.3</span>), <span class="at">lty =</span> <span class="dv">0</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(exp_den<span class="sc">$</span>y2 <span class="sc">~</span> exp_den<span class="sc">$</span>x, <span class="at">col =</span> mycols[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co"># scenario 3</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>exp_den <span class="ot">&lt;-</span> <span class="fu">density</span>(Mcmcdat_0[,<span class="st">"atten3"</span>])</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>exp_den<span class="sc">$</span>y2 <span class="ot">&lt;-</span> exp_den<span class="sc">$</span>y <span class="sc">/</span> <span class="fu">max</span>(exp_den<span class="sc">$</span>y)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>exp_l <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">which</span>(exp_den<span class="sc">$</span>x <span class="sc">&gt;=</span> <span class="fu">hdi</span>(exp_den, <span class="at">credMass =</span> <span class="fl">0.95</span>)[<span class="dv">1</span>]))</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>exp_h <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">which</span>(exp_den<span class="sc">$</span>x <span class="sc">&lt;</span> <span class="fu">hdi</span>(exp_den, <span class="at">credMass =</span> <span class="fl">0.95</span>)[<span class="dv">2</span>]))</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(exp_den<span class="sc">$</span>x[<span class="fu">c</span>(exp_l,exp_l<span class="sc">:</span>exp_h,exp_h)]), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,exp_den<span class="sc">$</span>y2[exp_l<span class="sc">:</span>exp_h],<span class="dv">0</span>), <span class="at">col =</span> <span class="fu">alpha</span>(mycols[<span class="dv">3</span>], <span class="fl">0.3</span>), <span class="at">lty =</span> <span class="dv">0</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(exp_den<span class="sc">$</span>y2 <span class="sc">~</span> exp_den<span class="sc">$</span>x, <span class="at">col =</span> mycols[<span class="dv">3</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Scenario 1"</span>, <span class="st">"Scenario 2"</span>, <span class="st">"Scenario 3"</span>, <span class="st">"Observed"</span>), <span class="at">fill =</span> <span class="fu">alpha</span>(mycols, <span class="fl">0.3</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> mycols[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="WedgeModel_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="deprecated" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="deprecated"><span class="header-section-number">10.7</span> DEPRECATED</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vector of QG for prediction</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ndiff <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>QGvec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># gather data for JAGS</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"nObs"</span> <span class="ot">=</span> <span class="fu">dim</span>(dat)[<span class="dv">1</span>], <span class="st">"nSites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd)), </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"sites"</span> <span class="ot">=</span> dat<span class="sc">$</span>site_name_cd, <span class="co">#"indev" = dat_wb2$isevent,</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Qg"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, <span class="st">"Qg2"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, <span class="st">"QG"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_big_cum_log, </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"QGvec"</span> <span class="ot">=</span> QGvec, <span class="st">"nDiff"</span> <span class="ot">=</span> ndiff)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters to monitor</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"alpha.mu"</span>, <span class="st">"beta.mu"</span>, <span class="st">"alpha.sigma"</span>, <span class="st">"beta.sigma"</span>, </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sig.alpha"</span>, <span class="st">"sig.beta"</span>, <span class="st">"sig.alpha.mu"</span>, <span class="st">"sig.beta.mu"</span>, <span class="st">"sig.alpha.sigma"</span>, <span class="st">"sig.beta.sigma"</span>, </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ag.alpha"</span>, <span class="st">"ag.beta"</span>, <span class="st">"ag.sig.alpha"</span>, <span class="st">"ag.sig.beta"</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"diff"</span>, <span class="st">"predlg"</span>, <span class="st">"loglik"</span>, <span class="st">"loglik2"</span>, <span class="st">"mu"</span>, <span class="st">"Qg"</span>, <span class="st">"portfolio1"</span>, <span class="st">"portfolio3"</span>, <span class="st">"atten3"</span>, <span class="st">"attenObs"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># run in jags</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>mod_0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model.file =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2.txt"</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">20</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">5000</span>, <span class="at">DIC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(mod_0, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/Fitted models/GgMod_Events.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, I plot the effect of Big G yield on global (i.e., among-site) variation in little g from the site-agnostic model. How does among-site variation in little g response to big G attenuate with increasing Big G? Note that this only considers the sites we have data for, not all possible locations in the river network. This could potentially be achieved by simulating data for new sites (see pg. 362 in Gelman and Hill, 2007), but would likely need to add slope-intercept correlation structure to the model to ensure that attenuation in preserved (see pg. 376 in Gelman and Hill).</p>
<p>We can visualize this another way, as site-specific differences between little g and Big G at different levels of water availability/Big G flow. This is ~equivalent to the plot above, but provides a site-level examination of Qg variation around QG and how those change over the range of Big G flow.</p>
<section id="null-model-simulations" class="level4" data-number="10.7.0.1">
<h4 data-number="10.7.0.1" class="anchored" data-anchor-id="null-model-simulations"><span class="header-section-number">10.7.0.1</span> Null model simulations</h4>
<p>How much among-site variation in little G response to Big G might we expect assuming homogeneity in flow regimes? This is the null hypotheses. Although Iâ€™m not sure this is the proper way to do thisâ€¦for each of n sites, I randomly sample from the posterior distributions of alpha.mu and beta.mu to generate site-specific relationships that all follow the global parameters/relationships.</p>
<p>Hereâ€™s an example of an individual simulationâ€¦</p>
<section id="portfolio-strength-1" class="level5">
<h5 class="anchored" data-anchor-id="portfolio-strength-1">Portfolio strength</h5>
<p>There are probably better ways to do this, but here Iâ€™m quantifying/visualizing what Iâ€™m calling â€œportfolio strengthâ€, or the degree of heterogeneity in streamflow regimes across the network, as a function of water availability (big G flow). Portfolio strength is calculated as the (median) observed among-site variation in little G divided by the (median) expected/simulated among site variation in little g assuming flow homogeneity. Thus, values &gt;1 and &lt;1 indicate greater and less heterogeneity in streamflow than expected under the assumption of homogeneity, respectively. I think this would be a good way to compare/standardize among basins.</p>
<p>Alternatively, portfolio strength can be defined as the ratio between among-site variation in little g at low vs.&nbsp;high values of Big G (sensu Chezik et al.&nbsp;2017)â€¦so we get distributions for observed and expected values, where a value of 1 indicates no portfolio behavior (no streamflow diversity at different levels of Big G). I donâ€™t think this makes sense because the whole point is the evaluation how diversity in flow regimes (i.e., portfolio strength) changes with water availability.</p>
</section>
</section>
<section id="agnostic-to-sites" class="level3" data-number="10.7.1">
<h3 data-number="10.7.1" class="anchored" data-anchor-id="agnostic-to-sites"><span class="header-section-number">10.7.1</span> Agnostic to sites</h3>
<p>This model evaluates the G-g relationship and the effect of G on sigma, but ignores site groupings. With respect to the sigma~G relationship, this is essentially what I am trying to reconstruct above using derived values.</p>
<section id="fit-the-jags-model" class="level4" data-number="10.7.1.1">
<h4 data-number="10.7.1.1" class="anchored" data-anchor-id="fit-the-jags-model"><span class="header-section-number">10.7.1.1</span> Fit the JAGS model</h4>
<p>Get MCMC samples and summary</p>
</section>
<section id="view-traceplots-1" class="level4" data-number="10.7.1.2">
<h4 data-number="10.7.1.2" class="anchored" data-anchor-id="view-traceplots-1"><span class="header-section-number">10.7.1.2</span> View traceplots</h4>
</section>
<section id="effect-of-g-on-sigma" class="level4" data-number="10.7.1.3">
<h4 data-number="10.7.1.3" class="anchored" data-anchor-id="effect-of-g-on-sigma"><span class="header-section-number">10.7.1.3</span> Effect of G on sigma</h4>
<p>Here, I plot the effects of Big G yield on among-site variation in little g (i.e., sigma). This describes the effect of water availability on network-wide heterogeneity in streamflow.</p>
</section>
</section>
<section id="porfolio-strength" class="level3" data-number="10.7.2">
<h3 data-number="10.7.2" class="anchored" data-anchor-id="porfolio-strength"><span class="header-section-number">10.7.2</span> Porfolio strength</h3>
<p>How much more heterogeneous is observed little g streamflow at different levels of water availability (Big G) relative to our expectations if among- and within-site streamflow diversity is eroded? What does this tell us about the relative contributions of within- and among-site diversity to the total streamflow diversity across the river network?</p>
<p>Portfolio strength is calculated as the observed variance divided by expected variance under different scenarios in which diversity is eroded. These relationships may provide a standardized approach to comparing â€œwedginessâ€ across basins</p>
</section>
<section id="attenuation-strength-1" class="level3" data-number="10.7.3">
<h3 data-number="10.7.3" class="anchored" data-anchor-id="attenuation-strength-1"><span class="header-section-number">10.7.3</span> Attenuation strength</h3>
<p>To what degree does diversity in streamflow regimes attenuate with increasing Big G? Attenuation strength is calculated as the variance at min G divided by variance at max G four our observed data and relevant scenarios. Note that for scenario 1, variance is constant over G and thus would equal 1. Therfore, a value of 1 represents no attenuation. These figures may provide a standardized approach to comparing â€œwedginessâ€ across basins.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Event Delineation/HydroEvents.html" class="pagination-link" aria-label="Hydro Event Delineation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hydro Event Delineation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Qualitative/Hysteresis.html" class="pagination-link" aria-label="Hysteresis">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Hysteresis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The Wedge Model"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>Purpose: Define the Wedge hypothesis and model in JAGS.</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE, message=FALSE}</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="in">library(mapview)</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="in">library(fasstr)</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="in">library(RColorBrewer)</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales)</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="in">library(dygraphs)</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="in">library(GGally)</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(R2jags)</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(MCMCvis)</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(loo)</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(HDInterval)</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(loo)</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpubr)</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Q, H, A</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>**Questions:**</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>How does water availability (G) affect *upstream* diversity in streamflow regimes (g)? </span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    a. How does streamflow diversity manifest as heterogeneity *within* and *among* locations in the upstream river network?</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>What are the relative contributions of within- and among-site diversity to the total streamflow diversity across the river network and does this change with water availability?</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>**The Wedge Hypothesis:** Among- and within-site diversity in g response to G drive spatiotemporal variation in flow across river networks</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Among-site wedge: heterogeneity in physical characteristics among sites diversify little g response during low flows, but diversity in little g response attenuates (decreases) during high flows</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Within-site wedge: within sites, variation in little g response to G is greater at low flows than at high flows </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Additive diversity in the response of little g to Big G among and within sites drives total streamflow diversity across river networks</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>**Approach**</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Break up data into manageable chunks using event/non-event delineation</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>    a. Using Big G flow time series data, perform baseflow separation and event delineation to break up data into event and intervening non-event (baseflow) periods. </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>    b. Apply Big G event/non-event periods to corresponding little g time series data and calculate (log) volumetric yield during each period for both G and g. </span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Using a Bayesian hierarchical model to account for site-level variation, model g ~ G, where g is (log) volumetric yield at little g and G is (log) volumetric yield at Big G during successive event/non-event periods.</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>    a. Fit site-aware and site-agnostic models to describe within- and among-site diversity in g response to G, respectively. </span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    b. Derive measures of observed and expected g variance dampening with increasing G under different assumptions regarding among- and within-site streamflow diversity</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conceptual diagram</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>The Wedge Hypothesis states that among- and within-site diversity in g response to G drive spatiotemporal variation in streamflow across entire river networks:</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="al">![The Wedge Hypothesis - general](WedgeHypDiag.jpg)</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>The hypothesis can be represented with a relatively simple hierarchical model:</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="al">![The Wedge Hypothesis - parameters](WedgeHypDiag_Decon.jpg)</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>From the fitted model, we can assess the relative contributions of within- and among-site diversity to total streamflow diversity across the river network and explore the extent to which this changes with water availability:</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="al">![The Wedge Hypothesis - portfolio strength](WedgeHypDiag_Portfolio.jpg)</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### Site info and event data</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="co"># site information and locations</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>siteinfo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/Data/EcoDrought_SiteInformation.csv"</span>)</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>siteinfo_sp <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(siteinfo, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(siteinfo_sp, <span class="at">zcol =</span> <span class="st">"designation"</span>)</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co"># delineated event/non-event volumetric yield data </span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Event Delineation/EcoDrought_Data_EventNonEvent_WestBrookonly.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">site_name =</span> <span class="fu">factor</span>(site_name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"West Brook Lower"</span>, <span class="st">"Mitchell Brook"</span>, <span class="st">"Jimmy Brook"</span>, <span class="st">"Obear Brook Lower"</span>, <span class="st">"West Brook Upper"</span>, <span class="st">"West Brook Reservoir"</span>, <span class="st">"Sanderson Brook"</span>, <span class="st">"Avery Brook"</span>, <span class="st">"West Whately Brook"</span>)))</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat)</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize g~G relationships</span></span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>View relationship between Big G and little g, color by site, facet by event/non-event.</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=9}</span></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods."</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="in">dat %&gt;% </span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(isevent = dplyr::recode(isevent, "1" = "Event", "2" = "Baseflow")) %&gt;% </span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = yield_big_cum_log, y = yield_little_cum_log, group = site_name, color = site_name)) + </span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + geom_abline(intercept = 0, slope = 1, linetype = "dashed") + </span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm", se = F) + facet_wrap(~isevent)</span></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>View relationship between Big G and little g, color by event/non-event, facet by site. For most sites (except may Obear Brook), G-g relationships are identical between events and non-event.</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=8}</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods."</span></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a><span class="in">dat %&gt;% </span></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(isevent = dplyr::recode(isevent, "1" = "Event", "2" = "Baseflow")) %&gt;% </span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = yield_big_cum_log, y = yield_little_cum_log, group = isevent, color = isevent)) + </span></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + geom_abline(intercept = 0, slope = 1, linetype = "dashed") + </span></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm") + facet_wrap(~site_name)</span></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Examine hysteresis</span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a>Does the g~G relationship change over time? </span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=8}</span></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods. Points colored by day of year."</span></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a><span class="in">dat %&gt;% </span></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(doy = yday(mindate)) %&gt;%</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = yield_big_cum_log, y = yield_little_cum_log, color = doy)) + </span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + geom_abline(intercept = 0, slope = 1, linetype = "dashed") + </span></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_gradient2(midpoint = 182, low = "orange", mid = "purple3", high = "orange") +</span></span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~site_name)</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=8}</span></span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Effect of (log) cumulative yield at Big G on (log) cumulative yield at little g during baseflow and event periods, by season."</span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="in">dat %&gt;% </span></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(season = ifelse(month(mindate) %in% c(12,1,2), "winter",</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a><span class="in">                         ifelse(month(mindate) %in% c(3,4,5), "spring",</span></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="in">                                ifelse(month(mindate) %in% c(6,7,8), "summer", "autumn")))) %&gt;%</span></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(x = yield_big_cum_log, y = yield_little_cum_log, group = season, color = season)) + </span></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + geom_abline(intercept = 0, slope = 1, linetype = "dashed") + </span></span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm") + facet_wrap(~site_name)</span></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a>Yes, it does appear that the relationship between g and G changes is time-dependent, potentially motivating some inclusion of time as a covariate (and interaction with big G effect...circular regression?). However, this also likely drives the shape/existence of the little wedges. So, is it necessary to account for?</span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Declare model</span></span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>Based on results above, there does not appear to be any significant difference in the G-g relationship for event and non-event periods. Therefore, do not include random intercepts/slopes (by event/non-event) in the model. Previously, I tried to estimate the G-g differences using an intercept model, with the magnitude of difference a function of water availability. However, when Q = Qg, this simplified to a linear regression between Qg (dependent var.) and QG (independent var.), which is ultimately what is of interest. I estimate this regression model below:</span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a>Correlation between site-level slopes and site-level intercepts is modeled as specified on pgs. 362 and 376 in Gelman and Hill (2007).</span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Data</span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*Qg*: log volumetric yield at little g</span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sites*: numeric site id</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*QG*: log volumetric yield at Big G</span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*nObs*: number of observations</span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*nSites*: number of sites (little g sites)</span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Parameters</span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*alpha*: site-level intercept</span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*beta*: site-level effect of Big G on little g (slope)</span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*alpha.mu*: global intercept</span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*beta.mu*: global effect of Big G on little g (slope)</span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*alpha.sigma*: site-level variability in the intercept</span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*beta.sigma*: site-level variability in the slope</span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sig.alpha*: site-level intercept for process error</span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sig.beta*: site-level effect of Big G on process error (slope)</span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sig.alpha.mu*: global process error intercept</span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sig.beta.mu*: global process error slope</span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sig.alpha.sigma*: site-level variability in process error intercept</span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*sig.beta.sigma*: site-level variability in process error slope</span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*rho*: correlation between site-leve intercepts (*alpha*) and slopes (*beta*)</span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Derived values</span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*predlg*: predicted little g</span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*diff*: difference between predicted little g and Big G</span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*VpObs*: observed population variance, conditional on x</span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*VpScen1*: expected population variance, no within or among-site diversity</span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*VpScen2*: expected population variance, no within-site diversity</span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*VpScen3*: expected population variance, no among-size diversity</span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*port1*, *port2*, *port3*: predicted portfolio strength (over a range of G) compared to 3 alternative hypotheses</span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>*attenObs*, *atten1*, *atten2*, *atten3*: attentuation strength ("wedginess") of observed data and expected under 3 alternative hypotheses</span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"model {</span></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a><span class="st">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:nObs) {</span></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a><span class="st">  Qg[i] ~ dnorm(mu[i], pow(sigma[i], -2))</span></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a><span class="st">  mu[i] &lt;- alpha[sites[i]] + beta[sites[i]] * QG[i]</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a><span class="st">  log(sigma[i]) &lt;- sig.alpha[sites[i]] + sig.beta[sites[i]] * QG[i]</span></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a><span class="st">  # Log-likelihood</span></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="st">  loglik[i] &lt;- logdensity.norm(Qg[i], mu[i], pow(sigma[i], -2))</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a><span class="st">  ## SITE AGNOSTIC</span></span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="st">  Qg2[i] ~ dnorm(ag.mu[i], pow(ag.sigma[i], -2))</span></span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a><span class="st">  ag.mu[i] &lt;- ag.alpha + ag.beta * QG[i]</span></span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a><span class="st">  log(ag.sigma[i]) &lt;- ag.sig.alpha + ag.sig.beta * QG[i]  </span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a><span class="st">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a><span class="st"># Site-specific parameters</span></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:nSites) {</span></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a><span class="st">    alpha[j] &lt;- B[j,1]</span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a><span class="st">    beta[j] &lt;- B[j,2]</span></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a><span class="st">    B[j,1:2] ~ dmnorm(B.hat[j,], Tau.B[,])</span></span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a><span class="st">    B.hat[j,1] &lt;- alpha.mu</span></span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a><span class="st">    B.hat[j,2] &lt;- beta.mu</span></span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a><span class="st">    sig.alpha[j] ~ dnorm(sig.alpha.mu, pow(sig.alpha.sigma, -2))</span></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a><span class="st">    sig.beta[j] ~ dnorm(sig.beta.mu, pow(sig.beta.sigma, -2))</span></span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a><span class="st"># global parameters</span></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="st">alpha.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a><span class="st">beta.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a><span class="st">sig.alpha.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a><span class="st">sig.beta.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a><span class="st"># variance-covariance matrix components</span></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a><span class="st">Tau.B[1:2,1:2] &lt;- inverse(Sigma.B[,])</span></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[1,1] &lt;- pow(alpha.sigma, 2)</span></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[2,2] &lt;- pow(beta.sigma, 2)</span></span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[1,2] &lt;- rho * alpha.sigma * beta.sigma</span></span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a><span class="st">Sigma.B[2,1] &lt;- Sigma.B[1,2]</span></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a><span class="st">alpha.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a><span class="st">beta.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a><span class="st">rho ~ dunif(-1,1)</span></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a><span class="st"># among-site variation in sigma parameters</span></span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a><span class="st">sig.alpha.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a><span class="st">sig.beta.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a><span class="st">## SITE AGNOSTIC</span></span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a><span class="st">ag.alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a><span class="st">ag.beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a><span class="st">ag.sig.alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a><span class="st">ag.sig.beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a><span class="st">##--- DERIVED VALUES ------------------------------------------------##</span></span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a><span class="st"># expected deviation from Big G</span></span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:nSites) { </span></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a><span class="st">  for (i in 1:nDiff) {</span></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a><span class="st">    predlg[j,i] &lt;- alpha[j] + beta[j] * QGvec[i]</span></span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a><span class="st">    diff[j,i] &lt;- (alpha[j] + beta[j] * QGvec[i]) - QGvec[i]</span></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a><span class="st">  }}</span></span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a><span class="st"># variance decomposition and standardization</span></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:nDiff) {</span></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a><span class="st">  # observed population variance, conditional on x</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a><span class="st">  VpObs[i] &lt;- ((beta.mu^2) * varx) + ((alpha.sigma^2) + ((QGvec[i]^2) * (beta.sigma^2)) + (2 * QGvec[i] * (rho * alpha.sigma * beta.sigma))) + ((exp(sig.alpha.mu + sig.beta.mu * QGvec[i]))^2)</span></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a><span class="st">  # expected population variance, no within or among-site diversity</span></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a><span class="st">  VpScen1[i] &lt;- ((beta.mu^2) * varx) + ((exp(sig.alpha.mu))^2)</span></span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a><span class="st">  # expected population variance, no within-site diversity</span></span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a><span class="st">  VpScen2[i] &lt;- ((beta.mu^2) * varx) + ((alpha.sigma^2) + ((QGvec[i]^2) * (beta.sigma^2)) + (2 * QGvec[i] * (rho * alpha.sigma * beta.sigma))) + ((exp(sig.alpha.mu))^2)</span></span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a><span class="st">  # expected population variance, no among-size diversity</span></span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a><span class="st">  VpScen3[i] &lt;- ((beta.mu^2) * varx) + ((exp(sig.alpha.mu + sig.beta.mu * QGvec[i]))^2)</span></span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a><span class="st">  # portfolio strength: how much more diversity in streamflow do we observe at the little g gages than expected under alternative (null) hypotheses?</span></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a><span class="st">  port1[i] &lt;- VpObs[i] / VpScen1[i]</span></span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a><span class="st">  port2[i] &lt;- VpObs[i] / VpScen2[i]</span></span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a><span class="st">  port3[i] &lt;- VpObs[i] / VpScen3[i]</span></span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a><span class="st">  # variance in raw response values, agnostic to site (i.e., variance in the sample)</span></span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a><span class="st">  VarAg[i] &lt;- (exp(ag.sig.alpha + ag.sig.beta * QGvec[i]))^2</span></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a><span class="st">  Vf[i] &lt;- (beta.mu^2) * varx</span></span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a><span class="st">  Vix[i] &lt;- (alpha.sigma^2) + ((QGvec[i]^2) * (beta.sigma^2)) + (2 * QGvec[i] * (rho * alpha.sigma * beta.sigma))</span></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a><span class="st">  Vr[i] &lt;- (exp(sig.alpha.mu + sig.beta.mu * QGvec[i]))^2</span></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a><span class="st"># attenuation strength: how much more diversity in streamflow (among little g gages) do we observe at low vs. high flows?</span></span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a><span class="st">attenObs &lt;- VpObs[1] / VpObs[nDiff]</span></span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a><span class="st">atten1 &lt;- VpScen1[1] / VpScen1[nDiff]</span></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a><span class="st">atten2 &lt;- VpScen2[1] / VpScen2[nDiff]</span></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a><span class="st">atten3 &lt;- VpScen3[1] / VpScen3[nDiff]</span></span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>, <span class="at">file =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2_corr.txt"</span>)</span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fit the model</span></span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a><span class="co"># vector of QG for prediction</span></span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a>ndiff <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a>QGvec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a><span class="co"># gather data for JAGS</span></span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"nObs"</span> <span class="ot">=</span> <span class="fu">dim</span>(dat)[<span class="dv">1</span>], <span class="st">"nSites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd)), </span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"sites"</span> <span class="ot">=</span> dat<span class="sc">$</span>site_name_cd, <span class="co">#"indev" = dat_wb2$isevent,</span></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Qg"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, <span class="st">"QG"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_big_cum_log, <span class="st">"Qg2"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, </span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"QGvec"</span> <span class="ot">=</span> QGvec, <span class="st">"nDiff"</span> <span class="ot">=</span> ndiff, <span class="st">"varx"</span> <span class="ot">=</span> <span class="fu">var</span>(dat<span class="sc">$</span>yield_big_cum_log))</span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters to monitor</span></span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"alpha.mu"</span>, <span class="st">"beta.mu"</span>, <span class="st">"alpha.sigma"</span>, <span class="st">"beta.sigma"</span>, </span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sig.alpha"</span>, <span class="st">"sig.beta"</span>, <span class="st">"sig.alpha.mu"</span>, <span class="st">"sig.beta.mu"</span>, <span class="st">"sig.alpha.sigma"</span>, <span class="st">"sig.beta.sigma"</span>, </span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"rho"</span>, <span class="st">"diff"</span>, <span class="st">"predlg"</span>, <span class="st">"loglik"</span>, <span class="st">"mu"</span>, <span class="st">"Qg"</span>, </span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"VpObs"</span>, <span class="st">"VpScen1"</span>, <span class="st">"VpScen2"</span>, <span class="st">"VpScen3"</span>, <span class="st">"port1"</span>, <span class="st">"port2"</span>, <span class="st">"port3"</span>, <span class="st">"attenObs"</span>, <span class="st">"atten1"</span>, <span class="st">"atten2"</span>, <span class="st">"atten3"</span>,</span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"VarAg"</span>, <span class="st">"Vf"</span>, <span class="st">"Vix"</span>, <span class="st">"Vr"</span>)</span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a><span class="co"># initial values</span></span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a>myinits <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">alpha.mu =</span> <span class="dv">0</span>, <span class="at">beta.mu =</span> <span class="dv">1</span>, <span class="at">alpha.sigma =</span> <span class="dv">1</span>, <span class="at">beta.sigma =</span> <span class="fl">0.1</span>, </span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a>       <span class="at">sig.alpha.mu =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">sig.beta.mu =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">sig.alpha.sigma =</span> <span class="fl">0.4</span>, <span class="at">sig.beta.sigma =</span> <span class="fl">0.05</span>, </span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a>       <span class="at">ag.alpha =</span> <span class="fl">0.3</span>, <span class="at">ag.beta =</span> <span class="dv">1</span>, <span class="at">ag.sig.alpha =</span> <span class="dv">0</span>, <span class="at">ag.sig.beta =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">rho =</span> <span class="sc">-</span><span class="fl">0.8</span>)</span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a><span class="co"># run in jags</span></span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a>mod_0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> myinits, <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model.file =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2_corr.txt"</span>,</span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">50</span>, <span class="at">n.burnin =</span> <span class="dv">4000</span>, <span class="at">n.iter =</span> <span class="dv">14000</span>, <span class="at">DIC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(mod_0, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/Fitted models/GgMod_Events.rds")</span></span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a>Get MCMC samples and summary</span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a>top_mod <span class="ot">&lt;-</span> mod_0</span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a><span class="co"># generate MCMC samples and store as an array</span></span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a>modelout <span class="ot">&lt;-</span> top_mod<span class="sc">$</span>BUGSoutput</span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a>McmcList <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">dim</span>(modelout<span class="sc">$</span>sims.array)[<span class="dv">2</span>])</span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(McmcList)) { McmcList[[i]] <span class="ot">=</span> <span class="fu">as.mcmc</span>(modelout<span class="sc">$</span>sims.array[,i,]) }</span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind MCMC samples from 10 chains </span></span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a>Mcmcdat_0 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(McmcList[[<span class="dv">1</span>]], McmcList[[<span class="dv">2</span>]], McmcList[[<span class="dv">3</span>]], McmcList[[<span class="dv">4</span>]], McmcList[[<span class="dv">5</span>]], McmcList[[<span class="dv">6</span>]], McmcList[[<span class="dv">7</span>]], McmcList[[<span class="dv">8</span>]], McmcList[[<span class="dv">9</span>]], McmcList[[<span class="dv">10</span>]])</span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a>param.summary_0 <span class="ot">&lt;-</span> modelout<span class="sc">$</span>summary</span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(param.summary_0)</span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model diagnostics</span></span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a><span class="fu">### View R-hat</span></span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a>Any problematic R-hat values (&gt;1.01)?</span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a>mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>][mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>summary[,<span class="dv">8</span>] <span class="sc">&gt;</span> <span class="fl">1.01</span>]</span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a><span class="fu">### View traceplots</span></span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a>For global parameters and hyperparameters only...</span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a><span class="fu">MCMCtrace</span>(mod_0, <span class="at">ind =</span> <span class="cn">TRUE</span>, <span class="at">params =</span> <span class="fu">c</span>(<span class="st">"alpha.mu"</span>, <span class="st">"beta.mu"</span>, <span class="st">"alpha.sigma"</span>, <span class="st">"beta.sigma"</span>, <span class="st">"sig.alpha.mu"</span>, <span class="st">"sig.beta.mu"</span>, <span class="st">"sig.alpha.sigma"</span>, <span class="st">"sig.beta.sigma"</span>, <span class="st">"rho"</span>), <span class="at">pdf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a><span class="fu">### PP check</span></span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a>Get observed and expected values</span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a>ppdat_obs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat_0[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="st">"Qg"</span>)])</span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a>ppdat_exp <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Mcmcdat_0[,<span class="fu">startsWith</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="st">"mu"</span>)])</span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a>Bayesian p-value: values approaching 0.5 indicate lack of bias in model estimates</span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdat_exp <span class="sc">&gt;</span> ppdat_obs) <span class="sc">/</span> (<span class="fu">dim</span>(ppdat_obs)[<span class="dv">1</span>]<span class="sc">*</span><span class="fu">dim</span>(ppdat_obs)[<span class="dv">2</span>])</span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a>Posterior predictive check: ensure linearity and ~1:1 relationship between expected and observed (log) volumetric Qg yield</span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=5}</span></span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4.5,4.5,1,1))</span></span>
<span id="cb41-377"><a href="#cb41-377" aria-hidden="true" tabindex="-1"></a><span class="in">plot(apply(ppdat_exp, 2, median) ~ apply(ppdat_obs, 2, median), xlab = "Observed Qg", ylab = "Expected Qg")</span></span>
<span id="cb41-378"><a href="#cb41-378" aria-hidden="true" tabindex="-1"></a><span class="in">abline(a = 0, b = 1, col = "red", lwd = 2)</span></span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topleft", legend = "1:1", lwd = 2, col = "red", bty = "n")</span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a>Site-specific posterior predictive check: does the model fit some sites better than others?</span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=7, fig.height=7}</span></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a><span class="in">tibble(obs = apply(ppdat_obs, 2, median), exp = apply(ppdat_exp, 2, median), sitecd = dat$site_name) %&gt;% ggplot(aes(x = obs, y = exp)) + geom_point() + geom_smooth(method = "lm") + geom_abline(intercept = 0, slope = 1, color = "red") + facet_wrap(~sitecd)</span></span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-386"><a href="#cb41-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model selection</span></span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a>Perform model selection using leave-one-out cross-validation (LOO-CV). Does the site-aware (random slopes/random intercepts) model perform better than the site-agnostic model?</span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a>*Note:* this will need to be updated once we add other random effects specifications. For now, use LOO-CV as an additional check on model fitting...i.e., examine Pareto k estimates.</span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a>Again, model is well specified for all but 1 data point (k &gt; 1)</span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a><span class="co"># get log-likelihoods</span></span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a>loglik1 <span class="ot">&lt;-</span> mod_0<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.list<span class="sc">$</span>loglik</span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a><span class="co"># get relative effective sample size</span></span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a>reff1 <span class="ot">&lt;-</span> <span class="fu">relative_eff</span>(<span class="fu">exp</span>(loglik1), <span class="at">chain_id =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">3</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">4</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">5</span>,<span class="dv">200</span>), </span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a>                                                 <span class="fu">rep</span>(<span class="dv">6</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">7</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">8</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">9</span>,<span class="dv">200</span>), <span class="fu">rep</span>(<span class="dv">10</span>,<span class="dv">200</span>)))</span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate loo</span></span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">&lt;-</span> <span class="fu">loo</span>(loglik1, <span class="at">r_eff =</span> reff1)</span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a><span class="co"># compare</span></span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loo1)</span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loo1)</span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plot model output</span></span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-416"><a href="#cb41-416" aria-hidden="true" tabindex="-1"></a><span class="fu">### Slope-int. correlation</span></span>
<span id="cb41-417"><a href="#cb41-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a>Slopes and intercepts are negatively correlated (this is not unexpected, and explains the attenuation/wedge shape of the data). As noted in Gelman and Hill, the strength of the correlation between slopes and intercepts is sensitive to how the data is centered (or not). Currently, data span 0 (in log space), so this isn't really an artifact of the issues mentioned in Gelman and Hill (although if we mean centered the data this relationship does weaken slightly). It may actually make the most sense to force the intercept to be at the lowest value of log(G) (i.e., add min(log(G)) to all data, G and g). Intercepts would then represent the maximum expected variation in g during periods of lowest water availability. Alternatively, we could force the intercept to be at the highest valyes of log(G) (i.e., subtract max log(G) from all data) and test for random vs. fixed intercept (as suggested by Ben). Random intercepts would suggest that we still do see site-level variation in g when overall flows are high, whereas a fixed intercept would suggest minimal/no site-level variation in g at high flows. However, we do ultimately need to the slope/intercept correlation structure to do the variance decomposition. </span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=8, fig.height=3}</span></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a><span class="in">sitib &lt;- tibble(site_name = levels(dat$site_name),</span></span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a><span class="in">                slopes = param.summary_0[str_subset(rownames(param.summary_0), pattern = "^beta")[1:9],5],</span></span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a><span class="in">                intercepts = param.summary_0[str_subset(rownames(param.summary_0), pattern = "^alpha")[1:9],5]) </span></span>
<span id="cb41-423"><a href="#cb41-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-424"><a href="#cb41-424" aria-hidden="true" tabindex="-1"></a><span class="in"># slope-intercept scatterplot</span></span>
<span id="cb41-425"><a href="#cb41-425" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- sitib %&gt;% ggplot(aes(x = slopes, y = intercepts, color = site_name)) + geom_point(size = 3) + theme_bw() + xlab("Site-level slope") + ylab("Site-level intercept")</span></span>
<span id="cb41-426"><a href="#cb41-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a><span class="in"># "rho" posterior density</span></span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- tibble(Mcmcdat_0[,"rho"]) %&gt;% ggplot(aes(x = Mcmcdat_0[, "rho"])) + geom_density(color = "black", fill = "grey") + theme_bw() + xlab("rho") + ylab("Posterior density") + xlim(-1,0)</span></span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange plots</span></span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a><span class="in">ggarrange(p2, p1, ncol = 2, widths = c(0.35, 0.65))</span></span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a><span class="in"># correlation</span></span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a><span class="in"># cor.test(sitib$intercepts, sitib$slopes)</span></span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=3}</span></span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a><span class="in">sitib &lt;- tibble(site_name = levels(dat$site_name),</span></span>
<span id="cb41-439"><a href="#cb41-439" aria-hidden="true" tabindex="-1"></a><span class="in">                slopes = param.summary_0[str_subset(rownames(param.summary_0), pattern = "^sig.beta")[1:9],5],</span></span>
<span id="cb41-440"><a href="#cb41-440" aria-hidden="true" tabindex="-1"></a><span class="in">                intercepts = param.summary_0[str_subset(rownames(param.summary_0), pattern = "^sig.alpha")[1:9],5]) </span></span>
<span id="cb41-441"><a href="#cb41-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-442"><a href="#cb41-442" aria-hidden="true" tabindex="-1"></a><span class="in"># slope-intercept scatterplot</span></span>
<span id="cb41-443"><a href="#cb41-443" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- sitib %&gt;% ggplot(aes(x = slopes, y = intercepts, color = site_name)) + geom_point(size = 3) + theme_bw() + xlab("Site-level slope") + ylab("Site-level intercept")</span></span>
<span id="cb41-444"><a href="#cb41-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-445"><a href="#cb41-445" aria-hidden="true" tabindex="-1"></a><span class="in"># "rho" posterior density</span></span>
<span id="cb41-446"><a href="#cb41-446" aria-hidden="true" tabindex="-1"></a><span class="in"># p2 &lt;- tibble(Mcmcdat_0[,"rho"]) %&gt;% ggplot(aes(x = Mcmcdat_0[, "rho"])) + geom_density(color = "black", fill = "grey") + theme_bw() + xlab("rho") + ylab("Posterior density") + xlim(-1,0)</span></span>
<span id="cb41-447"><a href="#cb41-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-448"><a href="#cb41-448" aria-hidden="true" tabindex="-1"></a><span class="in"># arrange plots</span></span>
<span id="cb41-449"><a href="#cb41-449" aria-hidden="true" tabindex="-1"></a><span class="in"># ggarrange(p2, p1, ncol = 2, widths = c(0.35, 0.65))</span></span>
<span id="cb41-450"><a href="#cb41-450" aria-hidden="true" tabindex="-1"></a><span class="in">p1</span></span>
<span id="cb41-451"><a href="#cb41-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-452"><a href="#cb41-452" aria-hidden="true" tabindex="-1"></a><span class="in"># correlation</span></span>
<span id="cb41-453"><a href="#cb41-453" aria-hidden="true" tabindex="-1"></a><span class="in">cor.test(sitib$intercepts, sitib$slopes)</span></span>
<span id="cb41-454"><a href="#cb41-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-455"><a href="#cb41-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-456"><a href="#cb41-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-457"><a href="#cb41-457" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect of G on g</span></span>
<span id="cb41-458"><a href="#cb41-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-459"><a href="#cb41-459" aria-hidden="true" tabindex="-1"></a>Here, I plot the results of the fitted model: site-specific effects of Big G yield on little g yield.</span>
<span id="cb41-462"><a href="#cb41-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-463"><a href="#cb41-463" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb41-464"><a href="#cb41-464" aria-hidden="true" tabindex="-1"></a>nvals <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb41-465"><a href="#cb41-465" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb41-466"><a href="#cb41-466" aria-hidden="true" tabindex="-1"></a>nsites <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd))</span>
<span id="cb41-467"><a href="#cb41-467" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> nvals)</span>
<span id="cb41-468"><a href="#cb41-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-469"><a href="#cb41-469" aria-hidden="true" tabindex="-1"></a><span class="co"># predict from model</span></span>
<span id="cb41-470"><a href="#cb41-470" aria-hidden="true" tabindex="-1"></a>pred_arr <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nsim, nvals, nsites))</span>
<span id="cb41-471"><a href="#cb41-471" aria-hidden="true" tabindex="-1"></a>pred_arr_summ <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim =</span> <span class="fu">c</span>(nvals, <span class="dv">3</span>, nsites))</span>
<span id="cb41-472"><a href="#cb41-472" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsites) {</span>
<span id="cb41-473"><a href="#cb41-473" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) {</span>
<span id="cb41-474"><a href="#cb41-474" aria-hidden="true" tabindex="-1"></a>    pred_arr[j,,k] <span class="ot">&lt;-</span> Mcmcdat_0[j,<span class="fu">paste</span>(<span class="st">"alpha["</span>, k, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)] <span class="sc">+</span> Mcmcdat_0[j,<span class="fu">paste</span>(<span class="st">"beta["</span>, k, <span class="st">"]"</span>, <span class="at">sep =</span> <span class="st">""</span>)] <span class="sc">*</span> x_seq</span>
<span id="cb41-475"><a href="#cb41-475" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-476"><a href="#cb41-476" aria-hidden="true" tabindex="-1"></a>  pred_arr_summ[,<span class="dv">1</span>,k] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_arr[,,k], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb41-477"><a href="#cb41-477" aria-hidden="true" tabindex="-1"></a>  pred_arr_summ[,<span class="dv">2</span>,k] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_arr[,,k], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb41-478"><a href="#cb41-478" aria-hidden="true" tabindex="-1"></a>  pred_arr_summ[,<span class="dv">3</span>,k] <span class="ot">&lt;-</span> <span class="fu">apply</span>(pred_arr[,,k], <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb41-479"><a href="#cb41-479" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-480"><a href="#cb41-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-481"><a href="#cb41-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-482"><a href="#cb41-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=7, fig.height=5}</span></span>
<span id="cb41-483"><a href="#cb41-483" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Effect of (log) volumetric yield at Big G on (log) cumulative yield at little g."</span></span>
<span id="cb41-484"><a href="#cb41-484" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,11), mfrow = c(1,1))</span></span>
<span id="cb41-485"><a href="#cb41-485" aria-hidden="true" tabindex="-1"></a><span class="in">gg_color_hue &lt;- function(n) { </span></span>
<span id="cb41-486"><a href="#cb41-486" aria-hidden="true" tabindex="-1"></a><span class="in">  hues = seq(15, 375, length = n + 1) </span></span>
<span id="cb41-487"><a href="#cb41-487" aria-hidden="true" tabindex="-1"></a><span class="in">  hcl(h = hues, l = 65, c = 100)[1:n] }</span></span>
<span id="cb41-488"><a href="#cb41-488" aria-hidden="true" tabindex="-1"></a><span class="in">mycols &lt;- gg_color_hue(9)</span></span>
<span id="cb41-489"><a href="#cb41-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-490"><a href="#cb41-490" aria-hidden="true" tabindex="-1"></a><span class="in"># combined</span></span>
<span id="cb41-491"><a href="#cb41-491" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = range(pred_arr)[1], to = range(pred_arr)[2], length.out = nvals) ~ x_seq, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "(log) volumetric yield at little g")</span></span>
<span id="cb41-492"><a href="#cb41-492" aria-hidden="true" tabindex="-1"></a><span class="in">for (k in 1:nsites) { </span></span>
<span id="cb41-493"><a href="#cb41-493" aria-hidden="true" tabindex="-1"></a><span class="in">  polygon(x = c(x_seq, rev(x_seq)), y = c(pred_arr_summ[,1,k], rev(pred_arr_summ[,3,k])), col = alpha(mycols[k], 0.2), border = NA)</span></span>
<span id="cb41-494"><a href="#cb41-494" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(pred_arr_summ[,2,k] ~ x_seq, lwd = 2, col = mycols[k])</span></span>
<span id="cb41-495"><a href="#cb41-495" aria-hidden="true" tabindex="-1"></a><span class="in">  points(yield_little_cum_log ~ yield_big_cum_log, data = dat %&gt;% filter(site_name_cd == k), col = mycols[k])</span></span>
<span id="cb41-496"><a href="#cb41-496" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-497"><a href="#cb41-497" aria-hidden="true" tabindex="-1"></a><span class="in">abline(a = 0, b = 1, lty = 2)</span></span>
<span id="cb41-498"><a href="#cb41-498" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topleft", legend = "1:1", lty = 2, bty = "n")</span></span>
<span id="cb41-499"><a href="#cb41-499" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE)</span></span>
<span id="cb41-500"><a href="#cb41-500" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", inset = c(-0.55, 0), legend = levels(dat$site_name), fill = alpha(mycols, 0.5), bty = "n")</span></span>
<span id="cb41-501"><a href="#cb41-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-502"><a href="#cb41-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-503"><a href="#cb41-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-504"><a href="#cb41-504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Within-site variation</span></span>
<span id="cb41-505"><a href="#cb41-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-506"><a href="#cb41-506" aria-hidden="true" tabindex="-1"></a>Here, I plot the effect of Big G yield on site-level variation in little g (i.e., sigma). How does site-specific variation in little g response to big G attenuate with increasing Big G?</span>
<span id="cb41-507"><a href="#cb41-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=7, fig.height=5}</span></span>
<span id="cb41-508"><a href="#cb41-508" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Increasing water availability decreases site-level heterogeneity in little g response to Big G. Lines and polygons represent the median and 95% credible interval of the relationship for each site (color)."</span></span>
<span id="cb41-509"><a href="#cb41-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-510"><a href="#cb41-510" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-511"><a href="#cb41-511" aria-hidden="true" tabindex="-1"></a><span class="in">nvals &lt;- 100</span></span>
<span id="cb41-512"><a href="#cb41-512" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- dim(Mcmcdat_0)[1]</span></span>
<span id="cb41-513"><a href="#cb41-513" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat$site_name_cd))</span></span>
<span id="cb41-514"><a href="#cb41-514" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(from = min(dat$yield_big_cum_log), to = max(dat$yield_big_cum_log), length.out = nvals)</span></span>
<span id="cb41-515"><a href="#cb41-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-516"><a href="#cb41-516" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr &lt;- array(NA, dim = c(nsim, nvals, nsites))</span></span>
<span id="cb41-517"><a href="#cb41-517" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_summ &lt;- array(NA, dim = c(3, nvals, nsites))</span></span>
<span id="cb41-518"><a href="#cb41-518" aria-hidden="true" tabindex="-1"></a><span class="in">for (k in 1:nsites) {</span></span>
<span id="cb41-519"><a href="#cb41-519" aria-hidden="true" tabindex="-1"></a><span class="in">  for (j in 1:nsim) {</span></span>
<span id="cb41-520"><a href="#cb41-520" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_arr[j,,k] &lt;- (exp(Mcmcdat_0[j,paste("sig.alpha[", k, "]", sep = "")] + Mcmcdat_0[j,paste("sig.beta[", k, "]", sep = "")] * x_seq))</span></span>
<span id="cb41-521"><a href="#cb41-521" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-522"><a href="#cb41-522" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:nvals) {</span></span>
<span id="cb41-523"><a href="#cb41-523" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_arr_summ[1,i,k] &lt;- quantile(pred_arr[,i,k], probs = 0.025)</span></span>
<span id="cb41-524"><a href="#cb41-524" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_arr_summ[2,i,k] &lt;- quantile(pred_arr[,i,k], probs = 0.5)</span></span>
<span id="cb41-525"><a href="#cb41-525" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_arr_summ[3,i,k] &lt;- quantile(pred_arr[,i,k], probs = 0.975)</span></span>
<span id="cb41-526"><a href="#cb41-526" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-527"><a href="#cb41-527" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-528"><a href="#cb41-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-529"><a href="#cb41-529" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,11), mfrow = c(1,1))</span></span>
<span id="cb41-530"><a href="#cb41-530" aria-hidden="true" tabindex="-1"></a><span class="in">gg_color_hue &lt;- function(n) { </span></span>
<span id="cb41-531"><a href="#cb41-531" aria-hidden="true" tabindex="-1"></a><span class="in">  hues = seq(15, 375, length = n + 1) </span></span>
<span id="cb41-532"><a href="#cb41-532" aria-hidden="true" tabindex="-1"></a><span class="in">  hcl(h = hues, l = 65, c = 100)[1:n] }</span></span>
<span id="cb41-533"><a href="#cb41-533" aria-hidden="true" tabindex="-1"></a><span class="in">mycols &lt;- gg_color_hue(9)</span></span>
<span id="cb41-534"><a href="#cb41-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-535"><a href="#cb41-535" aria-hidden="true" tabindex="-1"></a><span class="in"># polygons as 95% CIs</span></span>
<span id="cb41-536"><a href="#cb41-536" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = range(pred_arr_summ)[2], length.out = nvals) ~ x_seq, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Within-site variation in little g, sigma")</span></span>
<span id="cb41-537"><a href="#cb41-537" aria-hidden="true" tabindex="-1"></a><span class="in">for (k in 1:nsites) { </span></span>
<span id="cb41-538"><a href="#cb41-538" aria-hidden="true" tabindex="-1"></a><span class="in">  polygon(x = c(x_seq, rev(x_seq)), y = c(pred_arr_summ[1,,k], rev(pred_arr_summ[3,,k])), col = alpha(mycols[k], 0.2), border = NA)</span></span>
<span id="cb41-539"><a href="#cb41-539" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(pred_arr_summ[2,,k] ~ x_seq, col = mycols[k], lwd = 2)</span></span>
<span id="cb41-540"><a href="#cb41-540" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-541"><a href="#cb41-541" aria-hidden="true" tabindex="-1"></a><span class="in">par(xpd = TRUE)</span></span>
<span id="cb41-542"><a href="#cb41-542" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", inset = c(-0.55, 0), legend = levels(dat$site_name), fill = alpha(mycols, 0.5), bty = "n")</span></span>
<span id="cb41-543"><a href="#cb41-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-544"><a href="#cb41-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-545"><a href="#cb41-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-546"><a href="#cb41-546" aria-hidden="true" tabindex="-1"></a><span class="fu">### Among-site variation</span></span>
<span id="cb41-547"><a href="#cb41-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-548"><a href="#cb41-548" aria-hidden="true" tabindex="-1"></a>Here, I plot the effect of Big G yield on global (i.e., among-site) variation in little g. How does among-site variation in little g response to big G attenuate with increasing Big G? This is a derived parameter: the square root of the "phenotypic variance" (conditional on x) as defined in Shielzeth and Nakagawa (2022). </span>
<span id="cb41-549"><a href="#cb41-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-550"><a href="#cb41-550" aria-hidden="true" tabindex="-1"></a>From S&amp;N: "We note that the phenotypic variance VP as we calculate it here as the sum of additive variance components might differ slightly from the variance in response values as estimated from the raw data (Rights &amp; Sterba, 2020). The difference is that the sum of the variance components aims to estimate the population variance while the variance in raw response values represents to variance in the sample. Since the population variance is what is relevant to biological interpretation (de Villemereuil et al., 2018), the sum of additive components is usually preferable."</span>
<span id="cb41-553"><a href="#cb41-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-554"><a href="#cb41-554" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb41-555"><a href="#cb41-555" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb41-556"><a href="#cb41-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-557"><a href="#cb41-557" aria-hidden="true" tabindex="-1"></a><span class="co"># get derived values</span></span>
<span id="cb41-558"><a href="#cb41-558" aria-hidden="true" tabindex="-1"></a>pred_arr <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-559"><a href="#cb41-559" aria-hidden="true" tabindex="-1"></a>pred_arr_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-560"><a href="#cb41-560" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { pred_arr[j,] <span class="ot">&lt;-</span> (Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpObs"</span>)]) }</span>
<span id="cb41-561"><a href="#cb41-561" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiff) { pred_arr_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>)) }</span>
<span id="cb41-562"><a href="#cb41-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-563"><a href="#cb41-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-564"><a href="#cb41-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=5}</span></span>
<span id="cb41-565"><a href="#cb41-565" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Increasing water availability decreases among-site heterogeneity in little g response to Big G. Line and polygon represent the median and 95% credible interval of the relationship."</span></span>
<span id="cb41-566"><a href="#cb41-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-567"><a href="#cb41-567" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,0.5,0.5), mgp = c(2.5,1,0))</span></span>
<span id="cb41-568"><a href="#cb41-568" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 6, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Global variance, VpObs")</span></span>
<span id="cb41-569"><a href="#cb41-569" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_summ[,1], rev(pred_arr_summ[,3])), col = alpha("black", 0.2), border = NA)</span></span>
<span id="cb41-570"><a href="#cb41-570" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_summ[,2] ~ QGvec, col = "black", lwd = 2)</span></span>
<span id="cb41-571"><a href="#cb41-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-572"><a href="#cb41-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-573"><a href="#cb41-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-574"><a href="#cb41-574" aria-hidden="true" tabindex="-1"></a>Visually comparing the figure above with the data/regression fits figure, it seems like there is not as much variation in VpObs with x in the plot above as there "should" be. In the plot below, I directly compare the population variance (VpObs) with the sample variance (VarAg), derived from the site-agnostic model). While Schielzeth and Nakagawa (2022) state that the population and sample standard deviations (variances) may "differ slightly" (pg. 1216), the difference as plotted below seems quite large, which leads me to wonder if the variance decomposition model is specified correctly...</span>
<span id="cb41-575"><a href="#cb41-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=5}</span></span>
<span id="cb41-576"><a href="#cb41-576" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,0.5,0.5), mgp = c(2.5,1,0))</span></span>
<span id="cb41-577"><a href="#cb41-577" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- 100</span></span>
<span id="cb41-578"><a href="#cb41-578" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 6, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "")</span></span>
<span id="cb41-579"><a href="#cb41-579" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "VpObs")]) ~ QGvec, col = alpha("black", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-580"><a href="#cb41-580" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "VarAg")]) ~ QGvec, col = alpha("blue", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-581"><a href="#cb41-581" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("VpObs", "VarAg"), lty = 1, col = c("black", "blue"), bty = "n")</span></span>
<span id="cb41-582"><a href="#cb41-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-583"><a href="#cb41-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-584"><a href="#cb41-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-585"><a href="#cb41-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-586"><a href="#cb41-586" aria-hidden="true" tabindex="-1"></a>So what drives this difference? Below I plot the three components of Vp: Vf, Vix, and Vr, and the sum of Vix and Vr. The difference in VpObs and VarAg in the plot of above is driven in large part by the constant Vf, the variance explained by the fixed effects. Note that VarAg is the *residual variance* from the site-agnostic model, and thus does not include variance explained by fixed effects. For the site-aware model, the best approximation of VarAg is Vix + Vr, the between/amomg-site variance plus the residual variance (within site).</span>
<span id="cb41-587"><a href="#cb41-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=8, fig.height=8}</span></span>
<span id="cb41-588"><a href="#cb41-588" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,0.5,0.5), mgp = c(2.5,1,0), mfrow = c(2,2))</span></span>
<span id="cb41-589"><a href="#cb41-589" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- 100</span></span>
<span id="cb41-590"><a href="#cb41-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-591"><a href="#cb41-591" aria-hidden="true" tabindex="-1"></a><span class="in"># Vf</span></span>
<span id="cb41-592"><a href="#cb41-592" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 4, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Vf")</span></span>
<span id="cb41-593"><a href="#cb41-593" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "Vf")]) ~ QGvec, col = alpha("black", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-594"><a href="#cb41-594" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "VarAg")]) ~ QGvec, col = alpha("blue", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-595"><a href="#cb41-595" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Vf", "VarAg"), lty = 1, col = c("black", "blue"), bty = "n")</span></span>
<span id="cb41-596"><a href="#cb41-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-597"><a href="#cb41-597" aria-hidden="true" tabindex="-1"></a><span class="in"># Vix</span></span>
<span id="cb41-598"><a href="#cb41-598" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 4, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Vix")</span></span>
<span id="cb41-599"><a href="#cb41-599" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "Vix")]) ~ QGvec, col = alpha("black", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-600"><a href="#cb41-600" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "VarAg")]) ~ QGvec, col = alpha("blue", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-601"><a href="#cb41-601" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Vix", "VarAg"), lty = 1, col = c("black", "blue"), bty = "n")</span></span>
<span id="cb41-602"><a href="#cb41-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-603"><a href="#cb41-603" aria-hidden="true" tabindex="-1"></a><span class="in"># Vr</span></span>
<span id="cb41-604"><a href="#cb41-604" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 4, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Vr")</span></span>
<span id="cb41-605"><a href="#cb41-605" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "Vr")]) ~ QGvec, col = alpha("black", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-606"><a href="#cb41-606" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "VarAg")]) ~ QGvec, col = alpha("blue", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-607"><a href="#cb41-607" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Vr", "VarAg"), lty = 1, col = c("black", "blue"), bty = "n")</span></span>
<span id="cb41-608"><a href="#cb41-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-609"><a href="#cb41-609" aria-hidden="true" tabindex="-1"></a><span class="in"># Vix + Vr</span></span>
<span id="cb41-610"><a href="#cb41-610" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 4, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Vix + Vr")</span></span>
<span id="cb41-611"><a href="#cb41-611" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "Vix")]) + (Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "Vr")]) ~ QGvec, col = alpha("black", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-612"><a href="#cb41-612" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsim) { lines((Mcmcdat_0[i, str_subset(colnames(Mcmcdat_0), pattern = "VarAg")]) ~ QGvec, col = alpha("blue", 0.3), lwd = 0.5) }</span></span>
<span id="cb41-613"><a href="#cb41-613" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Vix + Vr", "VarAg"), lty = 1, col = c("black", "blue"), bty = "n")</span></span>
<span id="cb41-614"><a href="#cb41-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-615"><a href="#cb41-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-616"><a href="#cb41-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-617"><a href="#cb41-617" aria-hidden="true" tabindex="-1"></a>Why does this matter? </span>
<span id="cb41-618"><a href="#cb41-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-619"><a href="#cb41-619" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The best way to compare the plot of within-site variation in little g (sigma ~ G) and among-site variation in little g is probably to use the sum of Vix and Vr, ignoring Vf, as within-site variation (sigma) also effectively ignores fixed effect variance. </span>
<span id="cb41-620"><a href="#cb41-620" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>For calculation of portfolio effects, it likely does not matter as all variance scenarios contain the constant and thus the constant is divided out</span>
<span id="cb41-621"><a href="#cb41-621" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>But for calculation of attenuation strength, it appears to lead to substantial underestimates of attenuation, i.e., "wedginess". Attenuation strength is a ratio between variation at low vs high levels of G, so when a constant is added to both the numerator and denominator, the absolute difference is the same but the relative difference can be quite different</span>
<span id="cb41-622"><a href="#cb41-622" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Consider the following. 4 / 2 = 2 and 3 / 1 = 3. In both cases the absolute difference is the same (1) but the relative difference changes (2 vs. 3).</span>
<span id="cb41-623"><a href="#cb41-623" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-624"><a href="#cb41-624" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-625"><a href="#cb41-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-626"><a href="#cb41-626" aria-hidden="true" tabindex="-1"></a><span class="fu">### Portfolio strength</span></span>
<span id="cb41-627"><a href="#cb41-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-628"><a href="#cb41-628" aria-hidden="true" tabindex="-1"></a>First plot population/phenotypic variances, conditional on QG</span>
<span id="cb41-631"><a href="#cb41-631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-632"><a href="#cb41-632" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb41-633"><a href="#cb41-633" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb41-634"><a href="#cb41-634" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb41-635"><a href="#cb41-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-636"><a href="#cb41-636" aria-hidden="true" tabindex="-1"></a><span class="co"># get derived values</span></span>
<span id="cb41-637"><a href="#cb41-637" aria-hidden="true" tabindex="-1"></a>pred_arr_VpObs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-638"><a href="#cb41-638" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-639"><a href="#cb41-639" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-640"><a href="#cb41-640" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-641"><a href="#cb41-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-642"><a href="#cb41-642" aria-hidden="true" tabindex="-1"></a>pred_arr_VpObs_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-643"><a href="#cb41-643" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen1_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-644"><a href="#cb41-644" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen2_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-645"><a href="#cb41-645" aria-hidden="true" tabindex="-1"></a>pred_arr_VpScen3_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-646"><a href="#cb41-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-647"><a href="#cb41-647" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { </span>
<span id="cb41-648"><a href="#cb41-648" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpObs[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpObs"</span>)] </span>
<span id="cb41-649"><a href="#cb41-649" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen1[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpScen1"</span>)] </span>
<span id="cb41-650"><a href="#cb41-650" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen2[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpScen2"</span>)] </span>
<span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen3[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"VpScen3"</span>)] </span>
<span id="cb41-652"><a href="#cb41-652" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-653"><a href="#cb41-653" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiff) { </span>
<span id="cb41-654"><a href="#cb41-654" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpObs_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpObs[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-655"><a href="#cb41-655" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen1_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpScen1[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-656"><a href="#cb41-656" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen2_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpScen2[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-657"><a href="#cb41-657" aria-hidden="true" tabindex="-1"></a>  pred_arr_VpScen3_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_VpScen3[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-658"><a href="#cb41-658" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-659"><a href="#cb41-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-660"><a href="#cb41-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-661"><a href="#cb41-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=6, fig.height=5.5}</span></span>
<span id="cb41-662"><a href="#cb41-662" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Effect of water availability (log cumulative yield at Big G) on population variance in little g expected under three alternative (null) hypotheses and for observed data."</span></span>
<span id="cb41-663"><a href="#cb41-663" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb41-664"><a href="#cb41-664" aria-hidden="true" tabindex="-1"></a><span class="in">mycols &lt;- c(brewer.pal(3, "Dark2"), "black")</span></span>
<span id="cb41-665"><a href="#cb41-665" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,0.5,0.5), mgp = c(2.5,1,0), mfrow = c(2,2))</span></span>
<span id="cb41-666"><a href="#cb41-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-667"><a href="#cb41-667" aria-hidden="true" tabindex="-1"></a><span class="in"># VpScen1</span></span>
<span id="cb41-668"><a href="#cb41-668" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 1, to = 6, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Variance")</span></span>
<span id="cb41-669"><a href="#cb41-669" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_VpScen1_summ[,1], rev(pred_arr_VpScen1_summ[,3])), col = alpha(mycols[1], 0.2), border = NA)</span></span>
<span id="cb41-670"><a href="#cb41-670" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_VpScen1_summ[,2] ~ QGvec, col = mycols[1], lwd = 2)</span></span>
<span id="cb41-671"><a href="#cb41-671" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Scenario 1", bty = "n")</span></span>
<span id="cb41-672"><a href="#cb41-672" aria-hidden="true" tabindex="-1"></a><span class="in"># VpScen2</span></span>
<span id="cb41-673"><a href="#cb41-673" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 1, to = 6, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Variance")</span></span>
<span id="cb41-674"><a href="#cb41-674" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_VpScen2_summ[,1], rev(pred_arr_VpScen2_summ[,3])), col = alpha(mycols[2], 0.2), border = NA)</span></span>
<span id="cb41-675"><a href="#cb41-675" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_VpScen2_summ[,2] ~ QGvec, col = mycols[2], lwd = 2)</span></span>
<span id="cb41-676"><a href="#cb41-676" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Scenario 2", bty = "n")</span></span>
<span id="cb41-677"><a href="#cb41-677" aria-hidden="true" tabindex="-1"></a><span class="in"># VpScen3</span></span>
<span id="cb41-678"><a href="#cb41-678" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 1, to = 6, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Variance")</span></span>
<span id="cb41-679"><a href="#cb41-679" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_VpScen3_summ[,1], rev(pred_arr_VpScen3_summ[,3])), col = alpha(mycols[3], 0.2), border = NA)</span></span>
<span id="cb41-680"><a href="#cb41-680" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_VpScen3_summ[,2] ~ QGvec, col = mycols[3], lwd = 2)</span></span>
<span id="cb41-681"><a href="#cb41-681" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Scenario 3", bty = "n")</span></span>
<span id="cb41-682"><a href="#cb41-682" aria-hidden="true" tabindex="-1"></a><span class="in"># VpObs</span></span>
<span id="cb41-683"><a href="#cb41-683" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 1, to = 6, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) cumulative yield at Big G", ylab = "Variance")</span></span>
<span id="cb41-684"><a href="#cb41-684" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_VpObs_summ[,1], rev(pred_arr_VpObs_summ[,3])), col = alpha(mycols[4], 0.2), border = NA)</span></span>
<span id="cb41-685"><a href="#cb41-685" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_VpObs_summ[,2] ~ QGvec, col = mycols[4], lwd = 2)</span></span>
<span id="cb41-686"><a href="#cb41-686" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Observed", bty = "n")</span></span>
<span id="cb41-687"><a href="#cb41-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-688"><a href="#cb41-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-689"><a href="#cb41-689" aria-hidden="true" tabindex="-1"></a>Now to show portfolio strength: How much more variable is the observed data than what is expected under three (null) alternative hypotheses?</span>
<span id="cb41-690"><a href="#cb41-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-691"><a href="#cb41-691" aria-hidden="true" tabindex="-1"></a>Note: subtracted 1 from ratios so values &gt;0 indicate the observed data is more variable than expected and values &lt;0 indicate the observed data is less variable than expected</span>
<span id="cb41-694"><a href="#cb41-694" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-695"><a href="#cb41-695" aria-hidden="true" tabindex="-1"></a><span class="co"># control panel</span></span>
<span id="cb41-696"><a href="#cb41-696" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">dim</span>(Mcmcdat_0)[<span class="dv">1</span>]</span>
<span id="cb41-697"><a href="#cb41-697" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb41-698"><a href="#cb41-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-699"><a href="#cb41-699" aria-hidden="true" tabindex="-1"></a><span class="co"># get derived values</span></span>
<span id="cb41-700"><a href="#cb41-700" aria-hidden="true" tabindex="-1"></a>pred_arr_Port1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-701"><a href="#cb41-701" aria-hidden="true" tabindex="-1"></a>pred_arr_Port2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-702"><a href="#cb41-702" aria-hidden="true" tabindex="-1"></a>pred_arr_Port3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> ndiff)</span>
<span id="cb41-703"><a href="#cb41-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-704"><a href="#cb41-704" aria-hidden="true" tabindex="-1"></a>pred_arr_Port1_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-705"><a href="#cb41-705" aria-hidden="true" tabindex="-1"></a>pred_arr_Port2_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-706"><a href="#cb41-706" aria-hidden="true" tabindex="-1"></a>pred_arr_Port3_summ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> ndiff, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb41-707"><a href="#cb41-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-708"><a href="#cb41-708" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim) { </span>
<span id="cb41-709"><a href="#cb41-709" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port1[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"port1"</span>)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb41-710"><a href="#cb41-710" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port2[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"port2"</span>)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb41-711"><a href="#cb41-711" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port3[j,] <span class="ot">&lt;-</span> Mcmcdat_0[j, <span class="fu">str_subset</span>(<span class="fu">colnames</span>(Mcmcdat_0), <span class="at">pattern =</span> <span class="st">"port3"</span>)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb41-712"><a href="#cb41-712" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-713"><a href="#cb41-713" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiff) { </span>
<span id="cb41-714"><a href="#cb41-714" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port1_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_Port1[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-715"><a href="#cb41-715" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port2_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_Port2[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-716"><a href="#cb41-716" aria-hidden="true" tabindex="-1"></a>  pred_arr_Port3_summ[j,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(pred_arr_Port3[,j], <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.95</span>))</span>
<span id="cb41-717"><a href="#cb41-717" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-718"><a href="#cb41-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-719"><a href="#cb41-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-720"><a href="#cb41-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=6, fig.height=5.5}</span></span>
<span id="cb41-721"><a href="#cb41-721" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb41-722"><a href="#cb41-722" aria-hidden="true" tabindex="-1"></a><span class="in">mycols &lt;- c(brewer.pal(3, "Dark2"), "black")</span></span>
<span id="cb41-723"><a href="#cb41-723" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4,4,0.5,0.5), mgp = c(2.5,1,0), mfrow = c(2,2))</span></span>
<span id="cb41-724"><a href="#cb41-724" aria-hidden="true" tabindex="-1"></a><span class="in">ylim1 &lt;- -0.25</span></span>
<span id="cb41-725"><a href="#cb41-725" aria-hidden="true" tabindex="-1"></a><span class="in">ylim2 &lt;- 1.25</span></span>
<span id="cb41-726"><a href="#cb41-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-727"><a href="#cb41-727" aria-hidden="true" tabindex="-1"></a><span class="in"># VpScen1</span></span>
<span id="cb41-728"><a href="#cb41-728" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = ylim1, to = ylim2, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "Portfolio strength")</span></span>
<span id="cb41-729"><a href="#cb41-729" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_Port1_summ[,1], rev(pred_arr_Port1_summ[,3])), col = alpha(mycols[1], 0.2), border = NA)</span></span>
<span id="cb41-730"><a href="#cb41-730" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_Port1_summ[,2] ~ QGvec, col = mycols[1], lwd = 2)</span></span>
<span id="cb41-731"><a href="#cb41-731" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Scenario 1", bty = "n")</span></span>
<span id="cb41-732"><a href="#cb41-732" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = 0, lty = 2)</span></span>
<span id="cb41-733"><a href="#cb41-733" aria-hidden="true" tabindex="-1"></a><span class="in"># VpScen2</span></span>
<span id="cb41-734"><a href="#cb41-734" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = ylim1, to = ylim2, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "Portfolio strength")</span></span>
<span id="cb41-735"><a href="#cb41-735" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_Port2_summ[,1], rev(pred_arr_Port2_summ[,3])), col = alpha(mycols[2], 0.2), border = NA)</span></span>
<span id="cb41-736"><a href="#cb41-736" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_Port2_summ[,2] ~ QGvec, col = mycols[2], lwd = 2)</span></span>
<span id="cb41-737"><a href="#cb41-737" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Scenario 2", bty = "n")</span></span>
<span id="cb41-738"><a href="#cb41-738" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = 0, lty = 2)</span></span>
<span id="cb41-739"><a href="#cb41-739" aria-hidden="true" tabindex="-1"></a><span class="in"># VpScen3</span></span>
<span id="cb41-740"><a href="#cb41-740" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = ylim1, to = ylim2, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "Portfolio strength")</span></span>
<span id="cb41-741"><a href="#cb41-741" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_Port3_summ[,1], rev(pred_arr_Port3_summ[,3])), col = alpha(mycols[3], 0.2), border = NA)</span></span>
<span id="cb41-742"><a href="#cb41-742" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_Port3_summ[,2] ~ QGvec, col = mycols[3], lwd = 2)</span></span>
<span id="cb41-743"><a href="#cb41-743" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = "Scenario 3", bty = "n")</span></span>
<span id="cb41-744"><a href="#cb41-744" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = 0, lty = 2)</span></span>
<span id="cb41-745"><a href="#cb41-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-746"><a href="#cb41-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-747"><a href="#cb41-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-748"><a href="#cb41-748" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attenuation Strength</span></span>
<span id="cb41-749"><a href="#cb41-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-750"><a href="#cb41-750" aria-hidden="true" tabindex="-1"></a>To what degree does diversity in streamflow regimes attenuate with increasing Big G? Attenuation strength is calculated as the variance at min G divided by variance at max G four our observed data and three alternative hypotheses. Note that for scenario 1, variance is constant over G and thus would equal 1. Therefore, a value of 1 represents no attenuation. These figures may provide a standardized approach to comparing "wedginess" across basins.</span>
<span id="cb41-751"><a href="#cb41-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=4}</span></span>
<span id="cb41-752"><a href="#cb41-752" aria-hidden="true" tabindex="-1"></a><span class="in">mycols &lt;- c(brewer.pal(3, "Dark2"), "black")</span></span>
<span id="cb41-753"><a href="#cb41-753" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-754"><a href="#cb41-754" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 1, length.out = 100) ~ seq(from = 0.5, to = 3, length.out = 100), type = "n", xlab = "Attenuation strength", ylab = "Density")</span></span>
<span id="cb41-755"><a href="#cb41-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-756"><a href="#cb41-756" aria-hidden="true" tabindex="-1"></a><span class="in"># observed</span></span>
<span id="cb41-757"><a href="#cb41-757" aria-hidden="true" tabindex="-1"></a><span class="in">obs_den &lt;- density(Mcmcdat_0[,"attenObs"])</span></span>
<span id="cb41-758"><a href="#cb41-758" aria-hidden="true" tabindex="-1"></a><span class="in">obs_den$y2 &lt;- obs_den$y / max(obs_den$y)</span></span>
<span id="cb41-759"><a href="#cb41-759" aria-hidden="true" tabindex="-1"></a><span class="in">obs_l &lt;- min(which(obs_den$x &gt;= hdi(obs_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-760"><a href="#cb41-760" aria-hidden="true" tabindex="-1"></a><span class="in">obs_h &lt;- max(which(obs_den$x &lt; hdi(obs_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-761"><a href="#cb41-761" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(obs_den$x[c(obs_l,obs_l:obs_h,obs_h)]), y = c(0,obs_den$y2[obs_l:obs_h],0), col = alpha(mycols[4], 0.3), lty = 0)</span></span>
<span id="cb41-762"><a href="#cb41-762" aria-hidden="true" tabindex="-1"></a><span class="in">lines(obs_den$y2 ~ obs_den$x, col = mycols[4], lwd = 2)</span></span>
<span id="cb41-763"><a href="#cb41-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-764"><a href="#cb41-764" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario 2</span></span>
<span id="cb41-765"><a href="#cb41-765" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den &lt;- density(Mcmcdat_0[,"atten2"])</span></span>
<span id="cb41-766"><a href="#cb41-766" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den$y2 &lt;- exp_den$y / max(exp_den$y)</span></span>
<span id="cb41-767"><a href="#cb41-767" aria-hidden="true" tabindex="-1"></a><span class="in">exp_l &lt;- min(which(exp_den$x &gt;= hdi(exp_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-768"><a href="#cb41-768" aria-hidden="true" tabindex="-1"></a><span class="in">exp_h &lt;- max(which(exp_den$x &lt; hdi(exp_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-769"><a href="#cb41-769" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(exp_den$x[c(exp_l,exp_l:exp_h,exp_h)]), y = c(0,exp_den$y2[exp_l:exp_h],0), col = alpha(mycols[2], 0.3), lty = 0)</span></span>
<span id="cb41-770"><a href="#cb41-770" aria-hidden="true" tabindex="-1"></a><span class="in">lines(exp_den$y2 ~ exp_den$x, col = mycols[2], lwd = 2)</span></span>
<span id="cb41-771"><a href="#cb41-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-772"><a href="#cb41-772" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario 3</span></span>
<span id="cb41-773"><a href="#cb41-773" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den &lt;- density(Mcmcdat_0[,"atten3"])</span></span>
<span id="cb41-774"><a href="#cb41-774" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den$y2 &lt;- exp_den$y / max(exp_den$y)</span></span>
<span id="cb41-775"><a href="#cb41-775" aria-hidden="true" tabindex="-1"></a><span class="in">exp_l &lt;- min(which(exp_den$x &gt;= hdi(exp_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-776"><a href="#cb41-776" aria-hidden="true" tabindex="-1"></a><span class="in">exp_h &lt;- max(which(exp_den$x &lt; hdi(exp_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-777"><a href="#cb41-777" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(exp_den$x[c(exp_l,exp_l:exp_h,exp_h)]), y = c(0,exp_den$y2[exp_l:exp_h],0), col = alpha(mycols[3], 0.3), lty = 0)</span></span>
<span id="cb41-778"><a href="#cb41-778" aria-hidden="true" tabindex="-1"></a><span class="in">lines(exp_den$y2 ~ exp_den$x, col = mycols[3], lwd = 2)</span></span>
<span id="cb41-779"><a href="#cb41-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-780"><a href="#cb41-780" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Scenario 1", "Scenario 2", "Scenario 3", "Observed"), fill = alpha(mycols, 0.3), bty = "n")</span></span>
<span id="cb41-781"><a href="#cb41-781" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 1, lty = 1, lwd = 2, col = mycols[1])</span></span>
<span id="cb41-782"><a href="#cb41-782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-783"><a href="#cb41-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-784"><a href="#cb41-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-785"><a href="#cb41-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-786"><a href="#cb41-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-787"><a href="#cb41-787" aria-hidden="true" tabindex="-1"></a><span class="fu">## DEPRECATED</span></span>
<span id="cb41-788"><a href="#cb41-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-789"><a href="#cb41-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-790"><a href="#cb41-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-791"><a href="#cb41-791" aria-hidden="true" tabindex="-1"></a><span class="in">cat("model {</span></span>
<span id="cb41-792"><a href="#cb41-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-793"><a href="#cb41-793" aria-hidden="true" tabindex="-1"></a><span class="in">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb41-794"><a href="#cb41-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-795"><a href="#cb41-795" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nObs) {</span></span>
<span id="cb41-796"><a href="#cb41-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-797"><a href="#cb41-797" aria-hidden="true" tabindex="-1"></a><span class="in">  ## SITE AWARE</span></span>
<span id="cb41-798"><a href="#cb41-798" aria-hidden="true" tabindex="-1"></a><span class="in">  Qg[i] ~ dnorm(mu[i], pow(sigma[i], -2))</span></span>
<span id="cb41-799"><a href="#cb41-799" aria-hidden="true" tabindex="-1"></a><span class="in">  mu[i] &lt;- alpha[sites[i]] + beta[sites[i]] * QG[i]</span></span>
<span id="cb41-800"><a href="#cb41-800" aria-hidden="true" tabindex="-1"></a><span class="in">  log(sigma[i]) &lt;- sig.alpha[sites[i]] + sig.beta[sites[i]] * QG[i]</span></span>
<span id="cb41-801"><a href="#cb41-801" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb41-802"><a href="#cb41-802" aria-hidden="true" tabindex="-1"></a><span class="in">  ## SITE AGNOSTIC</span></span>
<span id="cb41-803"><a href="#cb41-803" aria-hidden="true" tabindex="-1"></a><span class="in">  Qg2[i] ~ dnorm(ag.mu[i], pow(ag.sigma[i], -2))</span></span>
<span id="cb41-804"><a href="#cb41-804" aria-hidden="true" tabindex="-1"></a><span class="in">  ag.mu[i] &lt;- ag.alpha + ag.beta * QG[i]</span></span>
<span id="cb41-805"><a href="#cb41-805" aria-hidden="true" tabindex="-1"></a><span class="in">  log(ag.sigma[i]) &lt;- ag.sig.alpha + ag.sig.beta * QG[i]  </span></span>
<span id="cb41-806"><a href="#cb41-806" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb41-807"><a href="#cb41-807" aria-hidden="true" tabindex="-1"></a><span class="in">  # Log-likelihood</span></span>
<span id="cb41-808"><a href="#cb41-808" aria-hidden="true" tabindex="-1"></a><span class="in">  loglik[i] &lt;- logdensity.norm(Qg[i], mu[i], pow(sigma[i], -2))</span></span>
<span id="cb41-809"><a href="#cb41-809" aria-hidden="true" tabindex="-1"></a><span class="in">  loglik2[i] &lt;- logdensity.norm(Qg2[i], ag.mu[i], pow(ag.sigma[i], -2))</span></span>
<span id="cb41-810"><a href="#cb41-810" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-811"><a href="#cb41-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-812"><a href="#cb41-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-813"><a href="#cb41-813" aria-hidden="true" tabindex="-1"></a><span class="in">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb41-814"><a href="#cb41-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-815"><a href="#cb41-815" aria-hidden="true" tabindex="-1"></a><span class="in">## SITE AWARE</span></span>
<span id="cb41-816"><a href="#cb41-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-817"><a href="#cb41-817" aria-hidden="true" tabindex="-1"></a><span class="in"># Site-specific parameters</span></span>
<span id="cb41-818"><a href="#cb41-818" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nSites) {</span></span>
<span id="cb41-819"><a href="#cb41-819" aria-hidden="true" tabindex="-1"></a><span class="in">    alpha[j] ~ dnorm(alpha.mu, pow(alpha.sigma, -2))</span></span>
<span id="cb41-820"><a href="#cb41-820" aria-hidden="true" tabindex="-1"></a><span class="in">    beta[j] ~ dnorm(beta.mu, pow(beta.sigma, -2))</span></span>
<span id="cb41-821"><a href="#cb41-821" aria-hidden="true" tabindex="-1"></a><span class="in">    sig.alpha[j] ~ dnorm(sig.alpha.mu, pow(sig.alpha.sigma, -2))</span></span>
<span id="cb41-822"><a href="#cb41-822" aria-hidden="true" tabindex="-1"></a><span class="in">    sig.beta[j] ~ dnorm(sig.beta.mu, pow(sig.beta.sigma, -2))</span></span>
<span id="cb41-823"><a href="#cb41-823" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb41-824"><a href="#cb41-824" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-825"><a href="#cb41-825" aria-hidden="true" tabindex="-1"></a><span class="in"># global intercepts and slopes</span></span>
<span id="cb41-826"><a href="#cb41-826" aria-hidden="true" tabindex="-1"></a><span class="in">alpha.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-827"><a href="#cb41-827" aria-hidden="true" tabindex="-1"></a><span class="in">beta.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-828"><a href="#cb41-828" aria-hidden="true" tabindex="-1"></a><span class="in">sig.alpha.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-829"><a href="#cb41-829" aria-hidden="true" tabindex="-1"></a><span class="in">sig.beta.mu ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-830"><a href="#cb41-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-831"><a href="#cb41-831" aria-hidden="true" tabindex="-1"></a><span class="in"># among-site variation in intercepts and slopes</span></span>
<span id="cb41-832"><a href="#cb41-832" aria-hidden="true" tabindex="-1"></a><span class="in">alpha.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-833"><a href="#cb41-833" aria-hidden="true" tabindex="-1"></a><span class="in">beta.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-834"><a href="#cb41-834" aria-hidden="true" tabindex="-1"></a><span class="in">sig.alpha.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-835"><a href="#cb41-835" aria-hidden="true" tabindex="-1"></a><span class="in">sig.beta.sigma ~ dunif(0.001, 100)</span></span>
<span id="cb41-836"><a href="#cb41-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-837"><a href="#cb41-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-838"><a href="#cb41-838" aria-hidden="true" tabindex="-1"></a><span class="in">## SITE AGNOSTIC</span></span>
<span id="cb41-839"><a href="#cb41-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-840"><a href="#cb41-840" aria-hidden="true" tabindex="-1"></a><span class="in"># global intercepts and slopes</span></span>
<span id="cb41-841"><a href="#cb41-841" aria-hidden="true" tabindex="-1"></a><span class="in">ag.alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-842"><a href="#cb41-842" aria-hidden="true" tabindex="-1"></a><span class="in">ag.beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-843"><a href="#cb41-843" aria-hidden="true" tabindex="-1"></a><span class="in">ag.sig.alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-844"><a href="#cb41-844" aria-hidden="true" tabindex="-1"></a><span class="in">ag.sig.beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-845"><a href="#cb41-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-846"><a href="#cb41-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-847"><a href="#cb41-847" aria-hidden="true" tabindex="-1"></a><span class="in">##--- DERIVED VALUES ------------------------------------------------##</span></span>
<span id="cb41-848"><a href="#cb41-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-849"><a href="#cb41-849" aria-hidden="true" tabindex="-1"></a><span class="in"># expected deviation from Big G</span></span>
<span id="cb41-850"><a href="#cb41-850" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nSites) { </span></span>
<span id="cb41-851"><a href="#cb41-851" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:nDiff) {</span></span>
<span id="cb41-852"><a href="#cb41-852" aria-hidden="true" tabindex="-1"></a><span class="in">    predlg[j,i] &lt;- alpha[j] + beta[j] * QGvec[i]</span></span>
<span id="cb41-853"><a href="#cb41-853" aria-hidden="true" tabindex="-1"></a><span class="in">    diff[j,i] &lt;- (alpha[j] + beta[j] * QGvec[i]) - QGvec[i]</span></span>
<span id="cb41-854"><a href="#cb41-854" aria-hidden="true" tabindex="-1"></a><span class="in">  }}</span></span>
<span id="cb41-855"><a href="#cb41-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-856"><a href="#cb41-856" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nDiff) {</span></span>
<span id="cb41-857"><a href="#cb41-857" aria-hidden="true" tabindex="-1"></a><span class="in">  portfolio1[i] &lt;- exp(ag.sig.alpha + ag.sig.beta * QGvec[i]) / exp(sig.alpha.mu)</span></span>
<span id="cb41-858"><a href="#cb41-858" aria-hidden="true" tabindex="-1"></a><span class="in">  portfolio3[i] &lt;- exp(ag.sig.alpha + ag.sig.beta * QGvec[i]) / exp(sig.alpha.mu + sig.beta.mu * QGvec[i])</span></span>
<span id="cb41-859"><a href="#cb41-859" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-860"><a href="#cb41-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-861"><a href="#cb41-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-862"><a href="#cb41-862" aria-hidden="true" tabindex="-1"></a><span class="in">atten3 &lt;- exp(sig.alpha.mu + sig.beta.mu * QGvec[1]) / exp(sig.alpha.mu + sig.beta.mu * QGvec[nDiff])</span></span>
<span id="cb41-863"><a href="#cb41-863" aria-hidden="true" tabindex="-1"></a><span class="in">attenObs &lt;- exp(ag.sig.alpha + ag.sig.beta * QGvec[1]) / exp(ag.sig.alpha + ag.sig.beta * QGvec[nDiff])</span></span>
<span id="cb41-864"><a href="#cb41-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-865"><a href="#cb41-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-866"><a href="#cb41-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-867"><a href="#cb41-867" aria-hidden="true" tabindex="-1"></a><span class="in">}", file = "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2.txt")</span></span>
<span id="cb41-868"><a href="#cb41-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-869"><a href="#cb41-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-872"><a href="#cb41-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb41-873"><a href="#cb41-873" aria-hidden="true" tabindex="-1"></a><span class="co"># vector of QG for prediction</span></span>
<span id="cb41-874"><a href="#cb41-874" aria-hidden="true" tabindex="-1"></a>ndiff <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb41-875"><a href="#cb41-875" aria-hidden="true" tabindex="-1"></a>QGvec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">to =</span> <span class="fu">max</span>(dat<span class="sc">$</span>yield_big_cum_log), <span class="at">length.out =</span> ndiff)</span>
<span id="cb41-876"><a href="#cb41-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-877"><a href="#cb41-877" aria-hidden="true" tabindex="-1"></a><span class="co"># gather data for JAGS</span></span>
<span id="cb41-878"><a href="#cb41-878" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"nObs"</span> <span class="ot">=</span> <span class="fu">dim</span>(dat)[<span class="dv">1</span>], <span class="st">"nSites"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>site_name_cd)), </span>
<span id="cb41-879"><a href="#cb41-879" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"sites"</span> <span class="ot">=</span> dat<span class="sc">$</span>site_name_cd, <span class="co">#"indev" = dat_wb2$isevent,</span></span>
<span id="cb41-880"><a href="#cb41-880" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Qg"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, <span class="st">"Qg2"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_little_cum_log, <span class="st">"QG"</span> <span class="ot">=</span> dat<span class="sc">$</span>yield_big_cum_log, </span>
<span id="cb41-881"><a href="#cb41-881" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"QGvec"</span> <span class="ot">=</span> QGvec, <span class="st">"nDiff"</span> <span class="ot">=</span> ndiff)</span>
<span id="cb41-882"><a href="#cb41-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-883"><a href="#cb41-883" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters to monitor</span></span>
<span id="cb41-884"><a href="#cb41-884" aria-hidden="true" tabindex="-1"></a>jags.params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"alpha.mu"</span>, <span class="st">"beta.mu"</span>, <span class="st">"alpha.sigma"</span>, <span class="st">"beta.sigma"</span>, </span>
<span id="cb41-885"><a href="#cb41-885" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"sig.alpha"</span>, <span class="st">"sig.beta"</span>, <span class="st">"sig.alpha.mu"</span>, <span class="st">"sig.beta.mu"</span>, <span class="st">"sig.alpha.sigma"</span>, <span class="st">"sig.beta.sigma"</span>, </span>
<span id="cb41-886"><a href="#cb41-886" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ag.alpha"</span>, <span class="st">"ag.beta"</span>, <span class="st">"ag.sig.alpha"</span>, <span class="st">"ag.sig.beta"</span>,</span>
<span id="cb41-887"><a href="#cb41-887" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"diff"</span>, <span class="st">"predlg"</span>, <span class="st">"loglik"</span>, <span class="st">"loglik2"</span>, <span class="st">"mu"</span>, <span class="st">"Qg"</span>, <span class="st">"portfolio1"</span>, <span class="st">"portfolio3"</span>, <span class="st">"atten3"</span>, <span class="st">"attenObs"</span>)</span>
<span id="cb41-888"><a href="#cb41-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-889"><a href="#cb41-889" aria-hidden="true" tabindex="-1"></a><span class="co"># run in jags</span></span>
<span id="cb41-890"><a href="#cb41-890" aria-hidden="true" tabindex="-1"></a>mod_0 <span class="ot">&lt;-</span> <span class="fu">jags.parallel</span>(<span class="at">data =</span> jags.data, <span class="at">inits =</span> <span class="cn">NULL</span>, <span class="at">parameters.to.save =</span> jags.params,</span>
<span id="cb41-891"><a href="#cb41-891" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model.file =</span> <span class="st">"C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_2.txt"</span>,</span>
<span id="cb41-892"><a href="#cb41-892" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.chains =</span> <span class="dv">10</span>, <span class="at">n.thin =</span> <span class="dv">20</span>, <span class="at">n.burnin =</span> <span class="dv">1000</span>, <span class="at">n.iter =</span> <span class="dv">5000</span>, <span class="at">DIC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-893"><a href="#cb41-893" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(mod_0, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/Fitted models/GgMod_Events.rds")</span></span>
<span id="cb41-894"><a href="#cb41-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-895"><a href="#cb41-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-896"><a href="#cb41-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-897"><a href="#cb41-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-898"><a href="#cb41-898" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- dim(Mcmcdat_0)[1]</span></span>
<span id="cb41-899"><a href="#cb41-899" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr &lt;- array(NA, dim = c(nsim, ndiff))</span></span>
<span id="cb41-900"><a href="#cb41-900" aria-hidden="true" tabindex="-1"></a><span class="in">for (k in 1:nsim) {</span></span>
<span id="cb41-901"><a href="#cb41-901" aria-hidden="true" tabindex="-1"></a><span class="in">  for (j in 1:ndiff) {</span></span>
<span id="cb41-902"><a href="#cb41-902" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_arr[k,j] &lt;- sd(c(Mcmcdat_0[k,paste("predlg[1,", j, "]", sep = "")],</span></span>
<span id="cb41-903"><a href="#cb41-903" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[2,", j, "]", sep = "")],</span></span>
<span id="cb41-904"><a href="#cb41-904" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[3,", j, "]", sep = "")],</span></span>
<span id="cb41-905"><a href="#cb41-905" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[4,", j, "]", sep = "")],</span></span>
<span id="cb41-906"><a href="#cb41-906" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[5,", j, "]", sep = "")],</span></span>
<span id="cb41-907"><a href="#cb41-907" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[6,", j, "]", sep = "")],</span></span>
<span id="cb41-908"><a href="#cb41-908" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[7,", j, "]", sep = "")],</span></span>
<span id="cb41-909"><a href="#cb41-909" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[8,", j, "]", sep = "")],</span></span>
<span id="cb41-910"><a href="#cb41-910" aria-hidden="true" tabindex="-1"></a><span class="in">                          Mcmcdat_0[k,paste("predlg[9,", j, "]", sep = "")]))</span></span>
<span id="cb41-911"><a href="#cb41-911" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-912"><a href="#cb41-912" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-913"><a href="#cb41-913" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_summ &lt;- tibble(low = apply(pred_arr, 2, quantile, probs = 0.025),</span></span>
<span id="cb41-914"><a href="#cb41-914" aria-hidden="true" tabindex="-1"></a><span class="in">                        med = apply(pred_arr, 2, quantile, probs = 0.5),</span></span>
<span id="cb41-915"><a href="#cb41-915" aria-hidden="true" tabindex="-1"></a><span class="in">                        upp = apply(pred_arr, 2, quantile, probs = 0.975))</span></span>
<span id="cb41-916"><a href="#cb41-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-917"><a href="#cb41-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-918"><a href="#cb41-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-919"><a href="#cb41-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-920"><a href="#cb41-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-921"><a href="#cb41-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-922"><a href="#cb41-922" aria-hidden="true" tabindex="-1"></a>Here, I plot the effect of Big G yield on global (i.e., among-site) variation in little g from the site-agnostic model. How does among-site variation in little g response to big G attenuate with increasing Big G? Note that this only considers the sites we have data for, not all possible locations in the river network. This could potentially be achieved by simulating data for new sites (see pg. 362 in Gelman and Hill, 2007), but would likely need to add slope-intercept correlation structure to the model to ensure that attenuation in preserved (see pg. 376 in Gelman and Hill).</span>
<span id="cb41-923"><a href="#cb41-923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-924"><a href="#cb41-924" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Increasing water availability decreases among-site heterogeneity in little g response to Big G. Line and polygon represent the median and 95% credible interval of the relationship."</span></span>
<span id="cb41-925"><a href="#cb41-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-926"><a href="#cb41-926" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-927"><a href="#cb41-927" aria-hidden="true" tabindex="-1"></a><span class="in">nvals &lt;- 100</span></span>
<span id="cb41-928"><a href="#cb41-928" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- dim(Mcmcdat_0)[1]</span></span>
<span id="cb41-929"><a href="#cb41-929" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat$site_name_cd))</span></span>
<span id="cb41-930"><a href="#cb41-930" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(from = min(dat$yield_big_cum_log), to = max(dat$yield_big_cum_log), length.out = nvals)</span></span>
<span id="cb41-931"><a href="#cb41-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-932"><a href="#cb41-932" aria-hidden="true" tabindex="-1"></a><span class="in"># predict from model</span></span>
<span id="cb41-933"><a href="#cb41-933" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr &lt;- matrix(NA, nrow = nsim, ncol = nvals)</span></span>
<span id="cb41-934"><a href="#cb41-934" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_summ &lt;- matrix(NA, nrow = nvals, ncol = 3)</span></span>
<span id="cb41-935"><a href="#cb41-935" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nsim) { pred_arr[j,] &lt;- exp(Mcmcdat_0[j,"ag.sig.alpha"] + Mcmcdat_0[j,"ag.sig.beta"] * x_seq) }</span></span>
<span id="cb41-936"><a href="#cb41-936" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nvals) { pred_arr_summ[j,] &lt;- quantile(pred_arr[,j], probs = c(0.025, 0.5, 0.95))}</span></span>
<span id="cb41-937"><a href="#cb41-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-938"><a href="#cb41-938" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb41-939"><a href="#cb41-939" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-940"><a href="#cb41-940" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = range(pred_arr_summ)[2], length.out = nvals) ~ x_seq, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "Among-site variation in little g (ag.sigma)")</span></span>
<span id="cb41-941"><a href="#cb41-941" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(x_seq, rev(x_seq)), y = c(pred_arr_summ[,1], rev(pred_arr_summ[,3])), col = alpha("black", 0.2), border = NA)</span></span>
<span id="cb41-942"><a href="#cb41-942" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_summ[,2] ~ x_seq, col = "black", lwd = 2)</span></span>
<span id="cb41-943"><a href="#cb41-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-944"><a href="#cb41-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-945"><a href="#cb41-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-946"><a href="#cb41-946" aria-hidden="true" tabindex="-1"></a>We can visualize this another way, as site-specific differences between little g and Big G at different levels of water availability/Big G flow. This is ~equivalent to the plot above, but provides a site-level examination of Qg variation around QG and how those change over the range of Big G flow.</span>
<span id="cb41-947"><a href="#cb41-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height = 5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-948"><a href="#cb41-948" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-949"><a href="#cb41-949" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat$site_name_cd))</span></span>
<span id="cb41-950"><a href="#cb41-950" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(-2.5, 2.5, length.out = 10)</span></span>
<span id="cb41-951"><a href="#cb41-951" aria-hidden="true" tabindex="-1"></a><span class="in">mylabs &lt;- c("Min. G", "Med. G", "Max. G")</span></span>
<span id="cb41-952"><a href="#cb41-952" aria-hidden="true" tabindex="-1"></a><span class="in">ctr &lt;- 1</span></span>
<span id="cb41-953"><a href="#cb41-953" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(1,3), mar = c(4,1,1.5,1), oma = c(0,2,0,0), mgp = c(1,0.75,0))</span></span>
<span id="cb41-954"><a href="#cb41-954" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in c(1,50,100)) {</span></span>
<span id="cb41-955"><a href="#cb41-955" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(x_seq ~ seq(0, 1, length.out = 10), type = "n", ylab = "", xlab = "", main = mylabs[ctr], axes = FALSE)</span></span>
<span id="cb41-956"><a href="#cb41-956" aria-hidden="true" tabindex="-1"></a><span class="in">  axis(2)</span></span>
<span id="cb41-957"><a href="#cb41-957" aria-hidden="true" tabindex="-1"></a><span class="in">  box(bty = "o")</span></span>
<span id="cb41-958"><a href="#cb41-958" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:nsites) {</span></span>
<span id="cb41-959"><a href="#cb41-959" aria-hidden="true" tabindex="-1"></a><span class="in">    dens &lt;- density(Mcmcdat_0[,paste("diff[", i, ",", j, "]", sep = "")])</span></span>
<span id="cb41-960"><a href="#cb41-960" aria-hidden="true" tabindex="-1"></a><span class="in">    dens$y2 &lt;- dens$y/max(dens$y)</span></span>
<span id="cb41-961"><a href="#cb41-961" aria-hidden="true" tabindex="-1"></a><span class="in">    l &lt;- min(which(dens$x &gt;= hdi(dens, credMass = 0.95)[1]))</span></span>
<span id="cb41-962"><a href="#cb41-962" aria-hidden="true" tabindex="-1"></a><span class="in">    h &lt;- max(which(dens$x &lt; hdi(dens, credMass = 0.95)[2]))</span></span>
<span id="cb41-963"><a href="#cb41-963" aria-hidden="true" tabindex="-1"></a><span class="in">    polygon(y = c(dens$x[c(l,l:h,h)]), x = c(0,dens$y2[l:h],0), col = alpha(mycols[i], 0.3), lty = 0)</span></span>
<span id="cb41-964"><a href="#cb41-964" aria-hidden="true" tabindex="-1"></a><span class="in">    lines(dens$x ~ dens$y2, col = mycols[i], lwd = 2)</span></span>
<span id="cb41-965"><a href="#cb41-965" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-966"><a href="#cb41-966" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb41-967"><a href="#cb41-967" aria-hidden="true" tabindex="-1"></a><span class="in">  ctr &lt;- ctr+1</span></span>
<span id="cb41-968"><a href="#cb41-968" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-969"><a href="#cb41-969" aria-hidden="true" tabindex="-1"></a><span class="in">mtext("Mean difference from Big G", side = 2, line = 1, outer = TRUE, cex = 0.8)</span></span>
<span id="cb41-970"><a href="#cb41-970" aria-hidden="true" tabindex="-1"></a><span class="in">mtext("Posterior density", side = 1, line = -2, outer = TRUE, cex = 0.8,)</span></span>
<span id="cb41-971"><a href="#cb41-971" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-972"><a href="#cb41-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-973"><a href="#cb41-973" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height = 5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-974"><a href="#cb41-974" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-975"><a href="#cb41-975" aria-hidden="true" tabindex="-1"></a><span class="in">nvals &lt;- 100</span></span>
<span id="cb41-976"><a href="#cb41-976" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- dim(Mcmcdat_0)[1]</span></span>
<span id="cb41-977"><a href="#cb41-977" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat$site_name_cd))</span></span>
<span id="cb41-978"><a href="#cb41-978" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(from = min(dat$yield_big_cum_log), to = max(dat$yield_big_cum_log), length.out = nvals)</span></span>
<span id="cb41-979"><a href="#cb41-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-980"><a href="#cb41-980" aria-hidden="true" tabindex="-1"></a><span class="in"># predict from model</span></span>
<span id="cb41-981"><a href="#cb41-981" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr &lt;- array(NA, dim = c(nsim, nvals, nsites))</span></span>
<span id="cb41-982"><a href="#cb41-982" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_summ &lt;- array(NA, dim = c(nvals, 3, nsites))</span></span>
<span id="cb41-983"><a href="#cb41-983" aria-hidden="true" tabindex="-1"></a><span class="in">for (k in 1:nsites) {</span></span>
<span id="cb41-984"><a href="#cb41-984" aria-hidden="true" tabindex="-1"></a><span class="in">  for (j in 1:nsim) {</span></span>
<span id="cb41-985"><a href="#cb41-985" aria-hidden="true" tabindex="-1"></a><span class="in">    pred_arr[j,,k] &lt;- Mcmcdat_0[j,paste("alpha[", k, "]", sep = "")] + Mcmcdat_0[j,paste("beta[", k, "]", sep = "")] * x_seq + dnorm(nvals, 0, exp(Mcmcdat_0[j,paste("sig.alpha[", k, "]", sep = "")] + Mcmcdat_0[j,paste("sig.beta[", k, "]", sep = "")] * x_seq)) - x_seq</span></span>
<span id="cb41-986"><a href="#cb41-986" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-987"><a href="#cb41-987" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-988"><a href="#cb41-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-989"><a href="#cb41-989" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-990"><a href="#cb41-990" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat$site_name_cd))</span></span>
<span id="cb41-991"><a href="#cb41-991" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(-2.5, 2.5, length.out = 10)</span></span>
<span id="cb41-992"><a href="#cb41-992" aria-hidden="true" tabindex="-1"></a><span class="in">mylabs &lt;- c("Min. G", "Med. G", "Max. G")</span></span>
<span id="cb41-993"><a href="#cb41-993" aria-hidden="true" tabindex="-1"></a><span class="in">ctr &lt;- 1</span></span>
<span id="cb41-994"><a href="#cb41-994" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(1,3), mar = c(4,1,1.5,1), oma = c(0,2,0,0), mgp = c(1,0.75,0))</span></span>
<span id="cb41-995"><a href="#cb41-995" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in c(1,50,100)) {</span></span>
<span id="cb41-996"><a href="#cb41-996" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(x_seq ~ seq(0, 1, length.out = 10), type = "n", ylab = "", xlab = "", main = mylabs[ctr], axes = FALSE)</span></span>
<span id="cb41-997"><a href="#cb41-997" aria-hidden="true" tabindex="-1"></a><span class="in">  axis(2)</span></span>
<span id="cb41-998"><a href="#cb41-998" aria-hidden="true" tabindex="-1"></a><span class="in">  box(bty = "o")</span></span>
<span id="cb41-999"><a href="#cb41-999" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:nsites) {</span></span>
<span id="cb41-1000"><a href="#cb41-1000" aria-hidden="true" tabindex="-1"></a><span class="in">    dens &lt;- density(pred_arr[,j,i])</span></span>
<span id="cb41-1001"><a href="#cb41-1001" aria-hidden="true" tabindex="-1"></a><span class="in">    dens$y2 &lt;- dens$y/max(dens$y)</span></span>
<span id="cb41-1002"><a href="#cb41-1002" aria-hidden="true" tabindex="-1"></a><span class="in">    l &lt;- min(which(dens$x &gt;= hdi(dens, credMass = 0.95)[1]))</span></span>
<span id="cb41-1003"><a href="#cb41-1003" aria-hidden="true" tabindex="-1"></a><span class="in">    h &lt;- max(which(dens$x &lt; hdi(dens, credMass = 0.95)[2]))</span></span>
<span id="cb41-1004"><a href="#cb41-1004" aria-hidden="true" tabindex="-1"></a><span class="in">    polygon(y = c(dens$x[c(l,l:h,h)]), x = c(0,dens$y2[l:h],0), col = alpha(mycols[i], 0.3), lty = 0)</span></span>
<span id="cb41-1005"><a href="#cb41-1005" aria-hidden="true" tabindex="-1"></a><span class="in">    lines(dens$x ~ dens$y2, col = mycols[i], lwd = 2)</span></span>
<span id="cb41-1006"><a href="#cb41-1006" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-1007"><a href="#cb41-1007" aria-hidden="true" tabindex="-1"></a><span class="in">  abline(h = 0, lty = 2)</span></span>
<span id="cb41-1008"><a href="#cb41-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  ctr &lt;- ctr+1</span></span>
<span id="cb41-1009"><a href="#cb41-1009" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-1010"><a href="#cb41-1010" aria-hidden="true" tabindex="-1"></a><span class="in">mtext("Mean difference from Big G", side = 2, line = 1, outer = TRUE, cex = 0.8)</span></span>
<span id="cb41-1011"><a href="#cb41-1011" aria-hidden="true" tabindex="-1"></a><span class="in">mtext("Posterior density", side = 1, line = -2, outer = TRUE, cex = 0.8,)</span></span>
<span id="cb41-1012"><a href="#cb41-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1013"><a href="#cb41-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1014"><a href="#cb41-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1015"><a href="#cb41-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1016"><a href="#cb41-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Null model simulations</span></span>
<span id="cb41-1017"><a href="#cb41-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1018"><a href="#cb41-1018" aria-hidden="true" tabindex="-1"></a>How much among-site variation in little G response to Big G might we expect assuming homogeneity in flow regimes? This is the null hypotheses. Although I'm not sure this is the proper way to do this...for each of n sites, I randomly sample from the posterior distributions of alpha.mu and beta.mu to generate site-specific relationships that all follow the global parameters/relationships.</span>
<span id="cb41-1019"><a href="#cb41-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1020"><a href="#cb41-1020" aria-hidden="true" tabindex="-1"></a><span class="in">nsims &lt;- 1000</span></span>
<span id="cb41-1021"><a href="#cb41-1021" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat_wb2$site_name_cd))</span></span>
<span id="cb41-1022"><a href="#cb41-1022" aria-hidden="true" tabindex="-1"></a><span class="in">sig_mat &lt;- matrix(NA, nrow = ndiff, ncol = nsims)</span></span>
<span id="cb41-1023"><a href="#cb41-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1024"><a href="#cb41-1024" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1025"><a href="#cb41-1025" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 1.1, length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "Simulated among-site variation in little g")</span></span>
<span id="cb41-1026"><a href="#cb41-1026" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nsims) {</span></span>
<span id="cb41-1027"><a href="#cb41-1027" aria-hidden="true" tabindex="-1"></a><span class="in">  myrows &lt;- sample(x = 1:dim(Mcmcdat_0)[1], size = nsites, replace = TRUE)</span></span>
<span id="cb41-1028"><a href="#cb41-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  myalphas &lt;- Mcmcdat_0[myrows, "alpha.mu"]</span></span>
<span id="cb41-1029"><a href="#cb41-1029" aria-hidden="true" tabindex="-1"></a><span class="in">  mybetas &lt;- Mcmcdat_0[myrows, "beta.mu"]</span></span>
<span id="cb41-1030"><a href="#cb41-1030" aria-hidden="true" tabindex="-1"></a><span class="in">  pred_mat &lt;- matrix(NA, nrow = ndiff, ncol = nsites)</span></span>
<span id="cb41-1031"><a href="#cb41-1031" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:nsites) { pred_mat[,i] &lt;- myalphas[i] + mybetas[i]*QGvec }</span></span>
<span id="cb41-1032"><a href="#cb41-1032" aria-hidden="true" tabindex="-1"></a><span class="in">  sim_sigma &lt;- apply(pred_mat, 1, sd)</span></span>
<span id="cb41-1033"><a href="#cb41-1033" aria-hidden="true" tabindex="-1"></a><span class="in">  sig_mat[,j] &lt;- sim_sigma</span></span>
<span id="cb41-1034"><a href="#cb41-1034" aria-hidden="true" tabindex="-1"></a><span class="in">  lines(sim_sigma ~ QGvec, col = alpha("grey", 0.2))</span></span>
<span id="cb41-1035"><a href="#cb41-1035" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-1036"><a href="#cb41-1036" aria-hidden="true" tabindex="-1"></a><span class="in">lines(apply(sig_mat, 1, quantile, probs = 0.025) ~ QGvec, col = "blue", lty = 2)</span></span>
<span id="cb41-1037"><a href="#cb41-1037" aria-hidden="true" tabindex="-1"></a><span class="in">lines(apply(sig_mat, 1, quantile, probs = 0.5) ~ QGvec, col = "blue", lwd = 2)</span></span>
<span id="cb41-1038"><a href="#cb41-1038" aria-hidden="true" tabindex="-1"></a><span class="in">lines(apply(sig_mat, 1, quantile, probs = 0.975) ~ QGvec, col = "blue", lty = 2)</span></span>
<span id="cb41-1039"><a href="#cb41-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1040"><a href="#cb41-1040" aria-hidden="true" tabindex="-1"></a><span class="in">lines(sim_sigma ~ QGvec, col = "red", lty = 3)</span></span>
<span id="cb41-1041"><a href="#cb41-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1042"><a href="#cb41-1042" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topleft", legend = c("Simulations", "Median", "95% CI"), lty = c(1,1,2), lwd = c(1,2,1), col = c(alpha("grey", 0.75), "blue", "blue"), bty = "n")</span></span>
<span id="cb41-1043"><a href="#cb41-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1044"><a href="#cb41-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1045"><a href="#cb41-1045" aria-hidden="true" tabindex="-1"></a>Here's an example of an individual simulation...</span>
<span id="cb41-1046"><a href="#cb41-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1047"><a href="#cb41-1047" aria-hidden="true" tabindex="-1"></a><span class="in">gg_color_hue &lt;- function(n) {</span></span>
<span id="cb41-1048"><a href="#cb41-1048" aria-hidden="true" tabindex="-1"></a><span class="in">  hues = seq(15, 375, length = n + 1)</span></span>
<span id="cb41-1049"><a href="#cb41-1049" aria-hidden="true" tabindex="-1"></a><span class="in">  hcl(h = hues, l = 65, c = 100)[1:n] }</span></span>
<span id="cb41-1050"><a href="#cb41-1050" aria-hidden="true" tabindex="-1"></a><span class="in">mycols &lt;- gg_color_hue(9)</span></span>
<span id="cb41-1051"><a href="#cb41-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1052"><a href="#cb41-1052" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1053"><a href="#cb41-1053" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = range(pred_mat)[1], to = range(pred_mat)[2], length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "(log) volumetric yield at little g")</span></span>
<span id="cb41-1054"><a href="#cb41-1054" aria-hidden="true" tabindex="-1"></a><span class="in">abline(a = 0, b = 1, lty = 2)</span></span>
<span id="cb41-1055"><a href="#cb41-1055" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nsites) { lines(pred_mat[,i] ~ QGvec, lwd = 2, col = mycols[i]) }</span></span>
<span id="cb41-1056"><a href="#cb41-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1057"><a href="#cb41-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1058"><a href="#cb41-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Portfolio strength</span></span>
<span id="cb41-1059"><a href="#cb41-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1060"><a href="#cb41-1060" aria-hidden="true" tabindex="-1"></a>There are probably better ways to do this, but here I'm quantifying/visualizing what I'm calling "portfolio strength", or the degree of heterogeneity in streamflow regimes across the network, as a function of water availability (big G flow). Portfolio strength is calculated as the (median) observed among-site variation in little G divided by the (median) expected/simulated among site variation in little g assuming flow homogeneity. Thus, values &gt;1 and &lt;1 indicate greater and less heterogeneity in streamflow than expected under the assumption of homogeneity, respectively. I think this would be a good way to compare/standardize among basins. </span>
<span id="cb41-1061"><a href="#cb41-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=5, fig.height=5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1062"><a href="#cb41-1062" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1063"><a href="#cb41-1063" aria-hidden="true" tabindex="-1"></a><span class="in">plot(pred_arr_summ$med / apply(sig_mat, 1, quantile, probs = 0.5) ~ QGvec, type = "l", lwd = 2, xlab = "(log) volumetric yield at Big G", ylab = "Portfolio strength")</span></span>
<span id="cb41-1064"><a href="#cb41-1064" aria-hidden="true" tabindex="-1"></a><span class="in">abline(a = 1, b = 0, lty = 2)</span></span>
<span id="cb41-1065"><a href="#cb41-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1066"><a href="#cb41-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1067"><a href="#cb41-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1068"><a href="#cb41-1068" aria-hidden="true" tabindex="-1"></a>Alternatively, portfolio strength can be defined as the ratio between among-site variation in little g at low vs. high values of Big G (sensu Chezik et al. 2017)...so we get distributions for observed and expected values, where a value of 1 indicates no portfolio behavior (no streamflow diversity at different levels of Big G). I don't think this makes sense because the whole point is the evaluation how diversity in flow regimes (i.e., portfolio strength) changes with water availability.</span>
<span id="cb41-1069"><a href="#cb41-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=4, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1070"><a href="#cb41-1070" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1071"><a href="#cb41-1071" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 1, length.out = 100) ~ seq(from = 0, to = 6, length.out = 100), type = "n", xlab = "Porfolio strength", ylab = "Density")</span></span>
<span id="cb41-1072"><a href="#cb41-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1073"><a href="#cb41-1073" aria-hidden="true" tabindex="-1"></a><span class="in"># observed among-site attenuation strength</span></span>
<span id="cb41-1074"><a href="#cb41-1074" aria-hidden="true" tabindex="-1"></a><span class="in">obs_den &lt;- density(pred_arr[,1] / pred_arr[,dim(pred_arr)[2]])</span></span>
<span id="cb41-1075"><a href="#cb41-1075" aria-hidden="true" tabindex="-1"></a><span class="in">obs_den$y2 &lt;- obs_den$y / max(obs_den$y)</span></span>
<span id="cb41-1076"><a href="#cb41-1076" aria-hidden="true" tabindex="-1"></a><span class="in">obs_l &lt;- min(which(obs_den$x &gt;= hdi(obs_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-1077"><a href="#cb41-1077" aria-hidden="true" tabindex="-1"></a><span class="in">obs_h &lt;- max(which(obs_den$x &lt; hdi(obs_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-1078"><a href="#cb41-1078" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(obs_den$x[c(obs_l,obs_l:obs_h,obs_h)]), y = c(0,obs_den$y2[obs_l:obs_h],0), col = alpha("black", 0.3), lty = 0)</span></span>
<span id="cb41-1079"><a href="#cb41-1079" aria-hidden="true" tabindex="-1"></a><span class="in">lines(obs_den$y2 ~ obs_den$x, col = "black", lwd = 2)</span></span>
<span id="cb41-1080"><a href="#cb41-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1081"><a href="#cb41-1081" aria-hidden="true" tabindex="-1"></a><span class="in"># expected among-site attenuation strength</span></span>
<span id="cb41-1082"><a href="#cb41-1082" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den &lt;- density(sig_mat[1,] / sig_mat[dim(sig_mat)[1],])</span></span>
<span id="cb41-1083"><a href="#cb41-1083" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den$y2 &lt;- exp_den$y / max(exp_den$y)</span></span>
<span id="cb41-1084"><a href="#cb41-1084" aria-hidden="true" tabindex="-1"></a><span class="in">exp_l &lt;- min(which(exp_den$x &gt;= hdi(exp_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-1085"><a href="#cb41-1085" aria-hidden="true" tabindex="-1"></a><span class="in">exp_h &lt;- max(which(exp_den$x &lt; hdi(exp_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-1086"><a href="#cb41-1086" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(exp_den$x[c(exp_l,exp_l:exp_h,exp_h)]), y = c(0,exp_den$y2[exp_l:exp_h],0), col = alpha("blue", 0.3), lty = 0)</span></span>
<span id="cb41-1087"><a href="#cb41-1087" aria-hidden="true" tabindex="-1"></a><span class="in">lines(exp_den$y2 ~ exp_den$x, col = "blue", lwd = 2)</span></span>
<span id="cb41-1088"><a href="#cb41-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1089"><a href="#cb41-1089" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Observed", "Expected"), fill = c(alpha("black", 0.3), alpha("blue", 0.3)), bty = "n")</span></span>
<span id="cb41-1090"><a href="#cb41-1090" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 1, lty = 2)</span></span>
<span id="cb41-1091"><a href="#cb41-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1092"><a href="#cb41-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1093"><a href="#cb41-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1094"><a href="#cb41-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agnostic to sites</span></span>
<span id="cb41-1095"><a href="#cb41-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1096"><a href="#cb41-1096" aria-hidden="true" tabindex="-1"></a>This model evaluates the G-g relationship and the effect of G on sigma, but ignores site groupings. With respect to the sigma~G relationship, this is essentially what I am trying to reconstruct above using derived values. </span>
<span id="cb41-1097"><a href="#cb41-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1098"><a href="#cb41-1098" aria-hidden="true" tabindex="-1"></a><span class="in">cat("model {</span></span>
<span id="cb41-1099"><a href="#cb41-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1100"><a href="#cb41-1100" aria-hidden="true" tabindex="-1"></a><span class="in">##--- LIKELIHOOD ---------------------------------------------------##</span></span>
<span id="cb41-1101"><a href="#cb41-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1102"><a href="#cb41-1102" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nObs) {</span></span>
<span id="cb41-1103"><a href="#cb41-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  Qg[i] ~ dnorm(mu[i], pow(sigma[i], -2))</span></span>
<span id="cb41-1104"><a href="#cb41-1104" aria-hidden="true" tabindex="-1"></a><span class="in">  mu[i] &lt;- alpha + beta * QG[i]</span></span>
<span id="cb41-1105"><a href="#cb41-1105" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb41-1106"><a href="#cb41-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  # effect of Big G yield on global process error</span></span>
<span id="cb41-1107"><a href="#cb41-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  log(sigma[i]) &lt;- alpha.sig + beta.sig * QG[i]</span></span>
<span id="cb41-1108"><a href="#cb41-1108" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb41-1109"><a href="#cb41-1109" aria-hidden="true" tabindex="-1"></a><span class="in">  # Log-likelihood</span></span>
<span id="cb41-1110"><a href="#cb41-1110" aria-hidden="true" tabindex="-1"></a><span class="in">  loglik[i] &lt;- logdensity.norm(Qg[i], mu[i], pow(sigma[i], -2))</span></span>
<span id="cb41-1111"><a href="#cb41-1111" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-1112"><a href="#cb41-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1113"><a href="#cb41-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1114"><a href="#cb41-1114" aria-hidden="true" tabindex="-1"></a><span class="in">##--- PRIORS --------------------------------------------------------##</span></span>
<span id="cb41-1115"><a href="#cb41-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1116"><a href="#cb41-1116" aria-hidden="true" tabindex="-1"></a><span class="in"># process error</span></span>
<span id="cb41-1117"><a href="#cb41-1117" aria-hidden="true" tabindex="-1"></a><span class="in">alpha.sig ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-1118"><a href="#cb41-1118" aria-hidden="true" tabindex="-1"></a><span class="in">beta.sig ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-1119"><a href="#cb41-1119" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-1120"><a href="#cb41-1120" aria-hidden="true" tabindex="-1"></a><span class="in"># global intercept and slope</span></span>
<span id="cb41-1121"><a href="#cb41-1121" aria-hidden="true" tabindex="-1"></a><span class="in">alpha ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-1122"><a href="#cb41-1122" aria-hidden="true" tabindex="-1"></a><span class="in">beta ~ dnorm(0, pow(10, -2))</span></span>
<span id="cb41-1123"><a href="#cb41-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1124"><a href="#cb41-1124" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb41-1125"><a href="#cb41-1125" aria-hidden="true" tabindex="-1"></a><span class="in">##--- DERIVED VALUES ------------------------------------------------##</span></span>
<span id="cb41-1126"><a href="#cb41-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1127"><a href="#cb41-1127" aria-hidden="true" tabindex="-1"></a><span class="in"># # expected deviation from Big G</span></span>
<span id="cb41-1128"><a href="#cb41-1128" aria-hidden="true" tabindex="-1"></a><span class="in"># for (j in 1:nSites) { </span></span>
<span id="cb41-1129"><a href="#cb41-1129" aria-hidden="true" tabindex="-1"></a><span class="in">#   for (k in 1:nDiff) {</span></span>
<span id="cb41-1130"><a href="#cb41-1130" aria-hidden="true" tabindex="-1"></a><span class="in">#     diff[j,k] &lt;- (alpha[j] + beta[j] * QGvec[k]) - QGvec[k]</span></span>
<span id="cb41-1131"><a href="#cb41-1131" aria-hidden="true" tabindex="-1"></a><span class="in">#   }}</span></span>
<span id="cb41-1132"><a href="#cb41-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1133"><a href="#cb41-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1134"><a href="#cb41-1134" aria-hidden="true" tabindex="-1"></a><span class="in">}", file = "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_3.txt")</span></span>
<span id="cb41-1135"><a href="#cb41-1135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1136"><a href="#cb41-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1137"><a href="#cb41-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fit the JAGS model</span></span>
<span id="cb41-1138"><a href="#cb41-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1139"><a href="#cb41-1139" aria-hidden="true" tabindex="-1"></a><span class="in"># gather data for JAGS</span></span>
<span id="cb41-1140"><a href="#cb41-1140" aria-hidden="true" tabindex="-1"></a><span class="in">jags.data &lt;- list("nObs" = dim(dat_wb2)[1], "nSites" = length(unique(dat_wb2$site_name_cd)), </span></span>
<span id="cb41-1141"><a href="#cb41-1141" aria-hidden="true" tabindex="-1"></a><span class="in">                  "sites" = dat_wb2$site_name_cd, #"indev" = dat_wb2$isevent,</span></span>
<span id="cb41-1142"><a href="#cb41-1142" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Qg" = dat_wb2$yield_little_cum_log, "QG" = dat_wb2$yield_big_cum_log)</span></span>
<span id="cb41-1143"><a href="#cb41-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1144"><a href="#cb41-1144" aria-hidden="true" tabindex="-1"></a><span class="in"># parameters to monitor</span></span>
<span id="cb41-1145"><a href="#cb41-1145" aria-hidden="true" tabindex="-1"></a><span class="in">jags.params &lt;- c("alpha", "beta", "alpha.sig", "beta.sig", "loglik", "mu", "Qg")</span></span>
<span id="cb41-1146"><a href="#cb41-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1147"><a href="#cb41-1147" aria-hidden="true" tabindex="-1"></a><span class="in"># run in jags</span></span>
<span id="cb41-1148"><a href="#cb41-1148" aria-hidden="true" tabindex="-1"></a><span class="in">mod_test &lt;- jags.parallel(data = jags.data, inits = NULL, parameters.to.save = jags.params,</span></span>
<span id="cb41-1149"><a href="#cb41-1149" aria-hidden="true" tabindex="-1"></a><span class="in">                       model.file = "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/GgMod_Events_3.txt",</span></span>
<span id="cb41-1150"><a href="#cb41-1150" aria-hidden="true" tabindex="-1"></a><span class="in">                       n.chains = 10, n.thin = 20, n.burnin = 1000, n.iter = 5000, DIC = FALSE)</span></span>
<span id="cb41-1151"><a href="#cb41-1151" aria-hidden="true" tabindex="-1"></a><span class="in"># saveRDS(mod_0, "C:/Users/jbaldock/OneDrive - DOI/Documents/USGS/EcoDrought/EcoDrought Working/EcoDrought-Analysis/Big G Little g/JAGS Models/Fitted models/GgMod_Events.rds")</span></span>
<span id="cb41-1152"><a href="#cb41-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1153"><a href="#cb41-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1154"><a href="#cb41-1154" aria-hidden="true" tabindex="-1"></a>Get MCMC samples and summary</span>
<span id="cb41-1155"><a href="#cb41-1155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1156"><a href="#cb41-1156" aria-hidden="true" tabindex="-1"></a><span class="in">top_mod &lt;- mod_test</span></span>
<span id="cb41-1157"><a href="#cb41-1157" aria-hidden="true" tabindex="-1"></a><span class="in"># generate MCMC samples and store as an array</span></span>
<span id="cb41-1158"><a href="#cb41-1158" aria-hidden="true" tabindex="-1"></a><span class="in">modelout &lt;- top_mod$BUGSoutput</span></span>
<span id="cb41-1159"><a href="#cb41-1159" aria-hidden="true" tabindex="-1"></a><span class="in">McmcList &lt;- vector("list", length = dim(modelout$sims.array)[2])</span></span>
<span id="cb41-1160"><a href="#cb41-1160" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(McmcList)) { McmcList[[i]] = as.mcmc(modelout$sims.array[,i,]) }</span></span>
<span id="cb41-1161"><a href="#cb41-1161" aria-hidden="true" tabindex="-1"></a><span class="in"># rbind MCMC samples from 10 chains </span></span>
<span id="cb41-1162"><a href="#cb41-1162" aria-hidden="true" tabindex="-1"></a><span class="in">Mcmcdat_test &lt;- rbind(McmcList[[1]], McmcList[[2]], McmcList[[3]], McmcList[[4]], McmcList[[5]], McmcList[[6]], McmcList[[7]], McmcList[[8]], McmcList[[9]], McmcList[[10]])</span></span>
<span id="cb41-1163"><a href="#cb41-1163" aria-hidden="true" tabindex="-1"></a><span class="in">param.summary_test &lt;- modelout$summary</span></span>
<span id="cb41-1164"><a href="#cb41-1164" aria-hidden="true" tabindex="-1"></a><span class="in">head(param.summary_test)</span></span>
<span id="cb41-1165"><a href="#cb41-1165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1166"><a href="#cb41-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1167"><a href="#cb41-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">#### View traceplots</span></span>
<span id="cb41-1168"><a href="#cb41-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1169"><a href="#cb41-1169" aria-hidden="true" tabindex="-1"></a><span class="in">MCMCtrace(mod_test, ind = TRUE, params = c("alpha", "beta", "alpha.sig", "beta.sig"), pdf = FALSE)</span></span>
<span id="cb41-1170"><a href="#cb41-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1171"><a href="#cb41-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1172"><a href="#cb41-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1173"><a href="#cb41-1173" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Effect of G on sigma</span></span>
<span id="cb41-1174"><a href="#cb41-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1175"><a href="#cb41-1175" aria-hidden="true" tabindex="-1"></a>Here, I plot the effects of Big G yield on among-site variation in little g (i.e., sigma). This describes the effect of water availability on network-wide heterogeneity in streamflow.</span>
<span id="cb41-1176"><a href="#cb41-1176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1177"><a href="#cb41-1177" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-1178"><a href="#cb41-1178" aria-hidden="true" tabindex="-1"></a><span class="in">nvals &lt;- 100</span></span>
<span id="cb41-1179"><a href="#cb41-1179" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- 100</span></span>
<span id="cb41-1180"><a href="#cb41-1180" aria-hidden="true" tabindex="-1"></a><span class="in">nsites &lt;- length(unique(dat_wb2$site_name_cd))</span></span>
<span id="cb41-1181"><a href="#cb41-1181" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(from = min(dat_wb2$yield_big_cum_log), to = max(dat_wb2$yield_big_cum_log), length.out = nvals)</span></span>
<span id="cb41-1182"><a href="#cb41-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1183"><a href="#cb41-1183" aria-hidden="true" tabindex="-1"></a><span class="in"># predict from model</span></span>
<span id="cb41-1184"><a href="#cb41-1184" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr &lt;- matrix(NA, nrow = nsim, ncol = nvals)</span></span>
<span id="cb41-1185"><a href="#cb41-1185" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_summ &lt;- matrix(NA, nrow = nvals, ncol = 3)</span></span>
<span id="cb41-1186"><a href="#cb41-1186" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nsim) { pred_arr[j,] &lt;- exp(Mcmcdat_test[j,"alpha.sig"] + Mcmcdat_test[j,"beta.sig"] * x_seq) }</span></span>
<span id="cb41-1187"><a href="#cb41-1187" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nvals) { pred_arr_summ[j,] &lt;- quantile(pred_arr[,j], probs = c(0.025, 0.5, 0.95))}</span></span>
<span id="cb41-1188"><a href="#cb41-1188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1189"><a href="#cb41-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1190"><a href="#cb41-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1191"><a href="#cb41-1191" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1192"><a href="#cb41-1192" aria-hidden="true" tabindex="-1"></a><span class="in"># among sites</span></span>
<span id="cb41-1193"><a href="#cb41-1193" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = range(pred_arr_summ)[2], length.out = nvals) ~ x_seq, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "sigma")</span></span>
<span id="cb41-1194"><a href="#cb41-1194" aria-hidden="true" tabindex="-1"></a><span class="in"># variable sigma</span></span>
<span id="cb41-1195"><a href="#cb41-1195" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(x_seq, rev(x_seq)), y = c(pred_arr_summ[,1], rev(pred_arr_summ[,3])), col = alpha("black", 0.2), border = NA)</span></span>
<span id="cb41-1196"><a href="#cb41-1196" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_summ[,2] ~ x_seq, col = "black", lwd = 2)</span></span>
<span id="cb41-1197"><a href="#cb41-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1198"><a href="#cb41-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1199"><a href="#cb41-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1200"><a href="#cb41-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1201"><a href="#cb41-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1202"><a href="#cb41-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Porfolio strength</span></span>
<span id="cb41-1203"><a href="#cb41-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1204"><a href="#cb41-1204" aria-hidden="true" tabindex="-1"></a>How much more heterogeneous is observed little g streamflow at different levels of water availability (Big G) relative to our expectations if among- and within-site streamflow diversity is eroded? What does this tell us about the relative contributions of within- and among-site diversity to the total streamflow diversity across the river network?</span>
<span id="cb41-1205"><a href="#cb41-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1206"><a href="#cb41-1206" aria-hidden="true" tabindex="-1"></a>Portfolio strength is calculated as the observed variance divided by expected variance under different scenarios in which diversity is eroded. These relationships may provide a standardized approach to comparing "wedginess" across basins</span>
<span id="cb41-1207"><a href="#cb41-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=5, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1208"><a href="#cb41-1208" aria-hidden="true" tabindex="-1"></a><span class="in"># control panel</span></span>
<span id="cb41-1209"><a href="#cb41-1209" aria-hidden="true" tabindex="-1"></a><span class="in">nsim &lt;- dim(Mcmcdat_0)[1]</span></span>
<span id="cb41-1210"><a href="#cb41-1210" aria-hidden="true" tabindex="-1"></a><span class="in">x_seq &lt;- seq(from = min(dat$yield_big_cum_log), to = max(dat$yield_big_cum_log), length.out = ndiff)</span></span>
<span id="cb41-1211"><a href="#cb41-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1212"><a href="#cb41-1212" aria-hidden="true" tabindex="-1"></a><span class="in"># get derived values</span></span>
<span id="cb41-1213"><a href="#cb41-1213" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_p1 &lt;- matrix(NA, nrow = nsim, ncol = nvals)</span></span>
<span id="cb41-1214"><a href="#cb41-1214" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_p3 &lt;- matrix(NA, nrow = nsim, ncol = nvals)</span></span>
<span id="cb41-1215"><a href="#cb41-1215" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_p1_summ &lt;- matrix(NA, nrow = ndiff, ncol = 3)</span></span>
<span id="cb41-1216"><a href="#cb41-1216" aria-hidden="true" tabindex="-1"></a><span class="in">pred_arr_p3_summ &lt;- matrix(NA, nrow = ndiff, ncol = 3)</span></span>
<span id="cb41-1217"><a href="#cb41-1217" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:nsim) { </span></span>
<span id="cb41-1218"><a href="#cb41-1218" aria-hidden="true" tabindex="-1"></a><span class="in">  pred_arr_p1[j,] &lt;- Mcmcdat_0[j, str_subset(colnames(Mcmcdat_0), pattern = "portfolio1")] </span></span>
<span id="cb41-1219"><a href="#cb41-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  pred_arr_p3[j,] &lt;- Mcmcdat_0[j, str_subset(colnames(Mcmcdat_0), pattern = "portfolio3")] </span></span>
<span id="cb41-1220"><a href="#cb41-1220" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-1221"><a href="#cb41-1221" aria-hidden="true" tabindex="-1"></a><span class="in">for (j in 1:ndiff) { </span></span>
<span id="cb41-1222"><a href="#cb41-1222" aria-hidden="true" tabindex="-1"></a><span class="in">  pred_arr_p1_summ[j,] &lt;- quantile(pred_arr_p1[,j], probs = c(0.025, 0.5, 0.95))</span></span>
<span id="cb41-1223"><a href="#cb41-1223" aria-hidden="true" tabindex="-1"></a><span class="in">  pred_arr_p3_summ[j,] &lt;- quantile(pred_arr_p3[,j], probs = c(0.025, 0.5, 0.95))</span></span>
<span id="cb41-1224"><a href="#cb41-1224" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-1225"><a href="#cb41-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1226"><a href="#cb41-1226" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb41-1227"><a href="#cb41-1227" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1228"><a href="#cb41-1228" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = range(c(pred_arr_p1_summ, pred_arr_p3_summ))[1], to = range(c(pred_arr_p1_summ, pred_arr_p3_summ))[2], length.out = ndiff) ~ QGvec, type = "n", xlab = "(log) volumetric yield at Big G", ylab = "Portfolio strength")</span></span>
<span id="cb41-1229"><a href="#cb41-1229" aria-hidden="true" tabindex="-1"></a><span class="in"># portfolio 1</span></span>
<span id="cb41-1230"><a href="#cb41-1230" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_p1_summ[,1], rev(pred_arr_p1_summ[,3])), col = alpha("black", 0.2), border = NA)</span></span>
<span id="cb41-1231"><a href="#cb41-1231" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_p1_summ[,2] ~ QGvec, col = "black", lwd = 2)</span></span>
<span id="cb41-1232"><a href="#cb41-1232" aria-hidden="true" tabindex="-1"></a><span class="in"># portfolio 3</span></span>
<span id="cb41-1233"><a href="#cb41-1233" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(QGvec, rev(QGvec)), y = c(pred_arr_p3_summ[,1], rev(pred_arr_p3_summ[,3])), col = alpha("blue", 0.2), border = NA)</span></span>
<span id="cb41-1234"><a href="#cb41-1234" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pred_arr_p3_summ[,2] ~ QGvec, col = "blue", lwd = 2)</span></span>
<span id="cb41-1235"><a href="#cb41-1235" aria-hidden="true" tabindex="-1"></a><span class="in"># reference line and legend</span></span>
<span id="cb41-1236"><a href="#cb41-1236" aria-hidden="true" tabindex="-1"></a><span class="in">abline(h = 1, lty = 2)</span></span>
<span id="cb41-1237"><a href="#cb41-1237" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("1. No within- or among-site diversity", "3. No among-site diversity"),</span></span>
<span id="cb41-1238"><a href="#cb41-1238" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = c(alpha("black", 0.3), alpha("blue", 0.3)), bty = "n")</span></span>
<span id="cb41-1239"><a href="#cb41-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1240"><a href="#cb41-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1241"><a href="#cb41-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1242"><a href="#cb41-1242" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attenuation strength</span></span>
<span id="cb41-1243"><a href="#cb41-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1244"><a href="#cb41-1244" aria-hidden="true" tabindex="-1"></a>To what degree does diversity in streamflow regimes attenuate with increasing Big G? Attenuation strength is calculated as the variance at min G divided by variance at max G four our observed data and relevant scenarios. Note that for scenario 1, variance is constant over G and thus would equal 1. Therfore, a value of 1 represents no attenuation. These figures may provide a standardized approach to comparing "wedginess" across basins.</span>
<span id="cb41-1245"><a href="#cb41-1245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width=6, fig.height=4, eval=FALSE, echo=FALSE}</span></span>
<span id="cb41-1246"><a href="#cb41-1246" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(5,5,1,1), mfrow = c(1,1))</span></span>
<span id="cb41-1247"><a href="#cb41-1247" aria-hidden="true" tabindex="-1"></a><span class="in">plot(seq(from = 0, to = 1, length.out = 100) ~ seq(from = 0, to = 7, length.out = 100), type = "n", xlab = "Attenuation strength", ylab = "Density")</span></span>
<span id="cb41-1248"><a href="#cb41-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1249"><a href="#cb41-1249" aria-hidden="true" tabindex="-1"></a><span class="in"># observed among-site attenuation strength</span></span>
<span id="cb41-1250"><a href="#cb41-1250" aria-hidden="true" tabindex="-1"></a><span class="in">obs_den &lt;- density(Mcmcdat_0[,"attenObs"])</span></span>
<span id="cb41-1251"><a href="#cb41-1251" aria-hidden="true" tabindex="-1"></a><span class="in">obs_den$y2 &lt;- obs_den$y / max(obs_den$y)</span></span>
<span id="cb41-1252"><a href="#cb41-1252" aria-hidden="true" tabindex="-1"></a><span class="in">obs_l &lt;- min(which(obs_den$x &gt;= hdi(obs_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-1253"><a href="#cb41-1253" aria-hidden="true" tabindex="-1"></a><span class="in">obs_h &lt;- max(which(obs_den$x &lt; hdi(obs_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-1254"><a href="#cb41-1254" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(obs_den$x[c(obs_l,obs_l:obs_h,obs_h)]), y = c(0,obs_den$y2[obs_l:obs_h],0), col = alpha("darkgreen", 0.3), lty = 0)</span></span>
<span id="cb41-1255"><a href="#cb41-1255" aria-hidden="true" tabindex="-1"></a><span class="in">lines(obs_den$y2 ~ obs_den$x, col = "darkgreen", lwd = 2)</span></span>
<span id="cb41-1256"><a href="#cb41-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1257"><a href="#cb41-1257" aria-hidden="true" tabindex="-1"></a><span class="in"># expected among-site attenuation strength</span></span>
<span id="cb41-1258"><a href="#cb41-1258" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den &lt;- density(Mcmcdat_0[,"atten3"])</span></span>
<span id="cb41-1259"><a href="#cb41-1259" aria-hidden="true" tabindex="-1"></a><span class="in">exp_den$y2 &lt;- exp_den$y / max(exp_den$y)</span></span>
<span id="cb41-1260"><a href="#cb41-1260" aria-hidden="true" tabindex="-1"></a><span class="in">exp_l &lt;- min(which(exp_den$x &gt;= hdi(exp_den, credMass = 0.95)[1]))</span></span>
<span id="cb41-1261"><a href="#cb41-1261" aria-hidden="true" tabindex="-1"></a><span class="in">exp_h &lt;- max(which(exp_den$x &lt; hdi(exp_den, credMass = 0.95)[2]))</span></span>
<span id="cb41-1262"><a href="#cb41-1262" aria-hidden="true" tabindex="-1"></a><span class="in">polygon(x = c(exp_den$x[c(exp_l,exp_l:exp_h,exp_h)]), y = c(0,exp_den$y2[exp_l:exp_h],0), col = alpha("blue", 0.3), lty = 0)</span></span>
<span id="cb41-1263"><a href="#cb41-1263" aria-hidden="true" tabindex="-1"></a><span class="in">lines(exp_den$y2 ~ exp_den$x, col = "blue", lwd = 2)</span></span>
<span id="cb41-1264"><a href="#cb41-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1265"><a href="#cb41-1265" aria-hidden="true" tabindex="-1"></a><span class="in">legend("topright", legend = c("Observed", "Scen. 3"), fill = c(alpha("darkgreen", 0.3), alpha("blue", 0.3)), bty = "n")</span></span>
<span id="cb41-1266"><a href="#cb41-1266" aria-hidden="true" tabindex="-1"></a><span class="in">abline(v = 1, lty = 2)</span></span>
<span id="cb41-1267"><a href="#cb41-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-1268"><a href="#cb41-1268" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>